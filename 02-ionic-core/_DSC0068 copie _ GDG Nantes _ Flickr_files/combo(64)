YUI.add("hermes-template-notif-item-group-blast",function(e,t){var a=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,t,a,i,n){var l,s,r=e.escapeExpression;return'<div class="notification-item notif-item-group-blast">\n\t<span class="notification-type">NotificationType: '+r("function"==typeof(s=null!=(s=a.type||(null!=t?t.type:t))?s:a.helperMissing)?s.call(null!=t?t:{},{name:"type",hash:{},data:n}):s)+'</span>\n\t<div class="entity-type">ObjectType: '+r(e.lambda(null!=(l=null!=t?t.activityData:t)?l.objectType:l,t))+"</div>\n</div>\n"},useData:!0}),i={};e.Array.each([],function(t){var a=e.Template.get("hermes/"+t);a&&(i[t]=a)}),e.Template.register("hermes/notif-item-group-blast",function(t,n){return n=n||{},n.partials=n.partials?e.merge(i,n.partials):i,a(t,n)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-notif-item-upload",function(e,t){var a=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,t,a,i,n){var l,s,p=e.escapeExpression;return'<div class="notification-item notif-item-upload">\n\t<span class="notification-type">NotificationType: '+p("function"==typeof(s=null!=(s=a.type||(null!=t?t.type:t))?s:a.helperMissing)?s.call(null!=t?t:{},{name:"type",hash:{},data:n}):s)+'</span>\n\t<div class="entity-type">ObjectType: '+p(e.lambda(null!=(l=null!=t?t.activityData:t)?l.objectType:l,t))+"</div>\n</div>\n"},useData:!0}),i={};e.Array.each([],function(t){var a=e.Template.get("hermes/"+t);a&&(i[t]=a)}),e.Template.register("hermes/notif-item-upload",function(t,n){return n=n||{},n.partials=n.partials?e.merge(i,n.partials):i,a(t,n)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("notifications-helper",function(e,t){var i=require("hermes-core/flog")(t),n=e.mix({langBundles:["notifications","relative-dates","profile","photo-card","header"]},e.Localizable),o={fave:"notif-item-fave",comment:"notif-item-comment",reply_reply:"notif-item-reply-reply",group_topic_new:"notif-item-group-topic-new",contacted:"notif-item-contacted",group_invite:"notif-item-group-invite",note:"notif-item-note",tag:"notif-item-tag",people:"notif-item-people",testimonial:"notif-item-testimonial",group_user_invite:"notif-item-group-user-invite",flickrmail:"notif-item-flickrmail",photo_comment_mention:"notif-item-photo-comment-mention",gallery:"notif-item-gallery",gallery_comment:"notif-item-gallery-comment",share:"notif-item-share",photo_accepted:"notif-item-photo-accepted",photo_declined:"notif-item-photo-declined",photo_mention:"notif-item-photo-mention",group_blast:"notif-item-group-blast",upload:"notif-item-upload"},a=50;e.NotificationsHelper=function(t,r){function l(e){var t=e.getSizeToFit({width:a,height:a},{sizes:e.getValue("sizes"),cropToFit:!0,includeSquare:!0});return{id:e.getValue("id"),url:e.getValue("url"),displayUrl:t.displayUrl}}function s(t,i){var n=[],o=[],a=[],r=[],l={},s=[];return t.activityData.users&&(t.activityData.users.forEach(function(e){o.push(m.person.extractEntityModel(e))}),n.push(e.Promise.all(o).then(function(e){return r=e,e}))),Object.keys(m).forEach(function(e){t.activityData[e]&&n.push(m[e].extractEntityModel(t.activityData[e]).then(function(t){return l[e]=t,t}))}),t.eventDataList.forEach(function(t){var i=[],n={};Object.keys(m).forEach(function(e){t[e]&&i.push(m[e].extractEntityModel(t[e]).then(function(t){return n[e]=t,t}))}),a.push(e.Promise.all(i).then(function(){return n}))}),n.push(e.Promise.all(a).then(function(e){return s=e,e})),e.Promise.all(n).then(function(){return{userModels:r,activityEntityModels:l,eventEntityModelsList:s}})}function u(e,t){return e.setValue("isContact",t),e.remoteUpdate().catch(function(t){e.setValue("isContact",!1),i.error({err:t})})}function p(e,t){return e.setValue("isIgnored",t),t&&e.setValue("isContact",!1),e.remoteUpdate().catch(function(t){e.setValue("isContact",!1),i.error({err:t})})}var c,m,d,g=new e.TemplateLibraryHelper(t,{localizeLib:n});m={photo:{extractEntityModel:function(i){return e.FlickrPromise({photoModelRegistry:t.getModelRegistry("photo-models"),personModelRegistry:t.getModelRegistry("person-models"),photoEngagementModelRegistry:t.getModelRegistry("photo-engagement-models"),photoStatsRegistry:t.getModelRegistry("photo-stats-models")}).then(function(t){var n=e.clone(i);if(n.title){var o=n.title.content||n.title._content;n.title=o}return e.APIHelper.response.parsePhotos({photos:[n],photoModelRegistry:t.photoModelRegistry,personModelRegistry:t.personModelRegistry,photoEngagementModelRegistry:t.photoEngagementModelRegistry,photoStatsModelRegistry:t.photoStatsRegistry}).shift()})}},set:{extractEntityModel:function(e){return e}},gallery:{extractEntityModel:function(i){return e.FlickrPromise({galleryModelRegistry:t.getModelRegistry("notification-gallery-models")}).then(function(e){return e.galleryModelRegistry.addOrUpdate(e.galleryModelRegistry.parseGalleryModel(i))})}},person:{extractEntityModel:function(i){return e.FlickrPromise({personModelRegistry:t.getModelRegistry("person-models")}).then(function(t){var n=i;return t.personModelRegistry.addOrUpdate(e.APIHelper.response.parsePerson({nsid:n.user,pathAlias:n.pathAlias,username:n.username,realname:n.realname,isAdFree:n.isAdFree,ispro:n.ispro,proBadge:n.proBadge,datecreate:n.datecreate,iconurls:n.iconurls}))})}},flickrmail:{extractEntityModel:function(i){return e.FlickrPromise({flickrMailModelRegistry:t.getModelRegistry("notification-flickrmail-models")}).then(function(e){return e.flickrMailModelRegistry.addOrUpdate(e.flickrMailModelRegistry.parseFlickrMailModel(i))})}},group:{extractEntityModel:function(i){return e.FlickrPromise({groupModelRegistry:t.getModelRegistry("group-models")}).then(function(e){return e.groupModelRegistry.addOrUpdate(e.groupModelRegistry.parseGroupModel(i.id,i.pathAlias,i))})}},discussion:{extractEntityModel:function(i){return e.FlickrPromise({groupModelRegistry:t.getModelRegistry("group-models"),discussionModelRegistry:t.getModelRegistry("notification-group-discussion-models")}).then(function(t){var n,o;return o=e.clone(i),o.id=i.group_id,o.title=i.group_name,n=t.groupModelRegistry.addOrUpdate(t.groupModelRegistry.parseGroupModel(i.group_id,i.pathAlias,o)),t.discussionModelRegistry.add(t.discussionModelRegistry.parseDiscussionModel(i.id,i.pathAlias,i,n))})}},testimonial:{extractEntityModel:function(e){return e}}},d={person:{loadConfig:function(i){i.item;var n=[];return n.push(d.default.loadConfig(i)),n.push(t.getModel("person-relationship-models",i.personModel.getValue("nsid"))),e.Promise.all(n).then(function(e){return{contextMenuType:"person",item:i.item,personModel:i.personModel,relationshipModel:e[1]}})},getConfig:function(i){var o;return(o=d.default.getConfig(i)).actionList.push({actionId:"sendMessage",text:n.intlMessage({intlName:"photo-card.SEND_A_MESSAGE"}),onSelected:function(t){e.config.win.open(e.URLHelper.generatePersonUrls(i.personModel).sendFlickrMail,"_blank")}}),i.relationshipModel.getValue("isIgnored")||(i.relationshipModel.getValue("isContact")?o.actionList.push({actionId:"unfollowOwner",text:n.intlHTMLMessage({intlName:"photo-card.UNFOLLOW_USER",username:i.personModel.getValue("displayname")}),onSelected:function(e){u(i.relationshipModel,!1)}}):o.actionList.push({actionId:"followOwner",text:n.intlHTMLMessage({intlName:"photo-card.FOLLOW_USER",username:i.personModel.getValue("displayname")}),onSelected:function(e){u(i.relationshipModel,!0)}})),i.relationshipModel.getValue("isIgnored")?o.actionList.push({actionId:"unblockOwner",text:n.intlHTMLMessage({intlName:"photo-card.UNBLOCK_USER",username:i.personModel.getValue("displayname")}),onSelected:function(e){p(i.relationshipModel,!1)}}):o.actionList.push({actionId:"blockOwner",text:n.intlHTMLMessage({intlName:"photo-card.BLOCK_USER",username:i.personModel.getValue("displayname")}),onSelected:function(o){!(function(i,o){var a=new e.Views.FluidModal({appContext:t,title:n.intlHTMLMessage({intlName:"photo-card.BLOCK_USER_QUESTION",username:o}),message:"<p>"+n.intlMessage({intlName:"photo-card.BLOCK_CONFIRM_MESSAGE"})+"</p><p>"+n.intlHTMLMessage({intlName:"photo-card.BLOCK_CONFIRM_MESSAGE_NOTE"})+"</p>",actionButtonIsDangerous:!0,actionButtonLabel:n.intlMessage({intlName:"header.BLOCK"}),overlayClassList:"over-droparound-under-modal"});a.show(),a.on("actionClick",function(){p(i,!0)})})(i.relationshipModel,i.personModel.getValue("displayname"))}}),o}},default:{loadConfig:function(t){return e.Promise.resolve()},getConfig:function(e){var t={actionList:[]};return e.item.activityData.isMuted?t.actionList.push({actionId:"unmuteNotification",text:"TMP Unmute this notification",onSelected:function(e){console.log("unmute!")}}):t.actionList.push({actionId:"muteNotification",text:"TMP Mute this notification",onSelected:function(e){console.log("mute!")}}),t}}},c={fave:{extractEntitiesFromResponse:function(e){return s(e)},setupView:function(e){return t.getView("base-notification-item-view",{activityItem:e}).then(function(e){return e.initialize()})},constructTemplateConfig:function(i){var o;if(i.activityData.photo){var a=i.activityEntityModels.photo,r=i.userModels;return o=i.activityData.countUsers>1?n.intlHTMLMessage({intlName:"notifications.NOTIF_X_PEOPLE_FAVED_1_PHOTO",personName:r[0].getValue("displayname"),personUrl:r[0].getValue("url"),personCountString:e.IntlNumber.format(i.activityData.countUsers,t.lang,1),photoTitle:a.getValue("title"),photoUrl:a.getValue("url")}):n.intlHTMLMessage({intlName:"notifications.NOTIF_1_PERSON_FAVED_1_PHOTO",personName:r[0].getValue("displayname"),personUrl:r[0].getValue("url"),photoTitle:a.getValue("title"),photoUrl:a.getValue("url")}),{headline:o,timestamp:i.timestamp,avatarData:{id:r[0].getValue("id"),type:"person",iconUrl:r[0].getValue("buddyicon").small,url:r[0].getValue("url")},photo:l(a)}}var s=i.userModels[0],u=i.eventEntityModelsList.map(function(e){return e.photo});return o=n.intlHTMLMessage({intlName:"notifications.NOTIF_1_PERSON_FAVED_X_PHOTOS",personName:s.getValue("displayname"),personUrl:s.getValue("url"),photoCountString:i.activityData.countEvents,mediaType:u[0].getValue("mediaType")}),{headline:o,timestamp:i.timestamp,avatarData:{id:s.getValue("id"),type:"person",iconUrl:s.getValue("buddyicon").small,url:s.getValue("url")},photos:u.map(function(e){return l(e)}).slice(0,12),hasMultiplePhotos:u.length>1}},loadContextMenuConfig:function(e){return d.person.loadConfig({item:e,personModel:e.userModels[0]})}},comment:{extractEntitiesFromResponse:function(e){return s(e)},setupView:function(e){return t.getView("base-notification-item-view",{activityItem:e}).then(function(e){return e.initialize()})},constructTemplateConfig:function(i){var o;if(i.activityData.photo){var a=i.activityEntityModels.photo,r=i.userModels;return o=i.activityData.countUsers>1?n.intlHTMLMessage({intlName:"notifications.NOTIF_X_PEOPLE_COMMENTED_1_PHOTO",personName:r[0].getValue("displayname"),personUrl:r[0].getValue("url"),personCountString:e.IntlNumber.format(i.activityData.countUsers,t.lang,1),photoTitle:a.getValue("title"),photoUrl:a.getValue("url")}):n.intlHTMLMessage({intlName:"notifications.NOTIF_1_PERSON_COMMENTED_1_PHOTO",personName:r[0].getValue("displayname"),personUrl:r[0].getValue("url"),commentUrl:a.getValue("url")+"/#comment"+i.eventDataList[0].commentid,commentContent:e.StringHelper.stripTags(i.eventDataList[0]._content)}),{headline:o,timestamp:i.timestamp,avatarData:{id:r[0].getValue("id"),type:"person",iconUrl:r[0].getValue("buddyicon").small,url:r[0].getValue("url")},photo:l(a)}}var s=i.userModels[0],u=i.eventEntityModelsList.map(function(e){return e.photo});return o=n.intlHTMLMessage({intlName:"notifications.NOTIF_1_PERSON_COMMENTED_X_PHOTOS",personName:s.getValue("displayname"),personUrl:s.getValue("url"),photoCountString:i.activityData.countEvents,mediaType:u[0].getValue("mediaType")}),{headline:o,timestamp:i.timestamp,avatarData:{id:s.getValue("id"),type:"person",iconUrl:s.getValue("buddyicon").small,url:s.getValue("url")},photos:u.map(function(e){return l(e)}).slice(0,12),hasMultiplePhotos:u.length>1}},loadContextMenuConfig:function(e){return d.person.loadConfig({item:e,personModel:e.userModels[0]})}},reply_reply:{},group_topic_new:{},contacted:{extractEntitiesFromResponse:function(e){return s(e)},setupView:function(e){return t.getView("follow-notification-item-view",{activityItem:e}).then(function(e){return e.initialize()})},constructTemplateConfig:function(e){var t,i=e.userModels;return t=n.intlHTMLMessage({intlName:"notifications.NOTIF_1_PERSON_FOLLOWED_YOU",personName:i[0].getValue("displayname"),personUrl:i[0].getValue("url")}),{headline:t,timestamp:e.timestamp,avatarData:{id:i[0].getValue("id"),type:"person",iconUrl:i[0].getValue("buddyicon").small,url:i[0].getValue("url")}}},loadContextMenuConfig:function(e){return d.person.loadConfig({item:e,personModel:e.userModels[0]})}},group_invite:{},note:{extractEntitiesFromResponse:function(e){return s(e)},setupView:function(e){return t.getView("base-notification-item-view",{activityItem:e}).then(function(e){return e.initialize()})},constructTemplateConfig:function(i){var o,a=i.activityEntityModels.photo,r=i.userModels;return o=i.activityData.countUsers>1?n.intlHTMLMessage({intlName:"notifications.NOTIF_X_PEOPLE_LEFT_NOTE_1_PHOTO",personName:r[0].getValue("displayname"),personUrl:r[0].getValue("url"),personCountString:e.IntlNumber.format(i.activityData.countUsers,t.lang,1),photoTitle:a.getValue("title"),photoUrl:a.getValue("url")}):n.intlHTMLMessage({intlName:"notifications.NOTIF_1_PERSON_LEFT_NOTE_1_PHOTO",personName:r[0].getValue("displayname"),personUrl:r[0].getValue("url"),noteUrl:a.getValue("url"),noteContent:e.StringHelper.stripTags(i.eventDataList[0]._content)}),{headline:o,timestamp:i.timestamp,avatarData:{id:r[0].getValue("id"),type:"person",iconUrl:r[0].getValue("buddyicon").small,url:r[0].getValue("url")},photo:l(a)}},loadContextMenuConfig:function(e){return d.person.loadConfig({item:e,personModel:e.userModels[0]})}},tag:{extractEntitiesFromResponse:function(e){return s(e)},setupView:function(e){return t.getView("base-notification-item-view",{activityItem:e}).then(function(e){return e.initialize()})},constructTemplateConfig:function(i){var o,a=i.activityEntityModels.photo,r=i.userModels;return o=i.activityData.countUsers>1?n.intlHTMLMessage({intlName:"notifications.NOTIF_X_PEOPLE_TAGGED_1_PHOTO",personName:r[0].getValue("displayname"),personUrl:r[0].getValue("url"),personCountString:e.IntlNumber.format(i.activityData.countUsers,t.lang,1),photoTitle:a.getValue("title"),photoUrl:a.getValue("url")}):n.intlHTMLMessage({intlName:"notifications.NOTIF_1_PERSON_TAGGED_1_PHOTO",personName:r[0].getValue("displayname"),personUrl:r[0].getValue("url"),tagUrl:a.getValue("url"),tagName:e.StringHelper.stripTags(i.eventDataList[0]._content)}),{headline:o,timestamp:i.timestamp,avatarData:{id:r[0].getValue("id"),type:"person",iconUrl:r[0].getValue("buddyicon").small,url:r[0].getValue("url")},photo:l(a)}},loadContextMenuConfig:function(e){return d.person.loadConfig({item:e,personModel:e.userModels[0]})}},people:{},testimonial:{extractEntitiesFromResponse:function(e){return s(e)},setupView:function(e){return t.getView("testimonial-notification-item-view",{activityItem:e}).then(function(e){return e.initialize()})},constructTemplateConfig:function(e){var i,o=e.userModels;return i=n.intlHTMLMessage({intlName:"notifications.NOTIF_1_PERSON_TESTIMONIAL",personName:o[0].getValue("displayname"),personUrl:o[0].getValue("url"),testimonialUrl:"/people/"+t.getViewer().nsid+"/#testimonial"+e.eventDataList[0].id,testimonialContent:"TMP The testimonial content from this notification"}),{headline:i,timestamp:e.timestamp,avatarData:{id:o[0].getValue("id"),type:"person",iconUrl:o[0].getValue("buddyicon").small,url:o[0].getValue("url")}}},loadContextMenuConfig:function(e){return d.person.loadConfig({item:e,personModel:e.userModels[0]})}},group_user_invite:{},flickrmail:{extractEntitiesFromResponse:function(e){return s(e)},setupView:function(e){return t.getView("base-notification-item-view",{activityItem:e}).then(function(e){return e.initialize()})},constructTemplateConfig:function(t){var i,o=t.userModels;return i=n.intlHTMLMessage({intlName:"notifications.NOTIF_1_PERSON_FLICKRMAIL",personName:o[0].getValue("displayname"),personUrl:o[0].getValue("url"),flickrmailUrl:"/mail/"+t.eventDataList[0].id,flickrmailContent:e.StringHelper.stripTags(t.eventDataList[0].subject)}),{headline:i,timestamp:t.timestamp,avatarData:{id:o[0].getValue("id"),type:"person",iconUrl:o[0].getValue("buddyicon").small,url:o[0].getValue("url")}}},loadContextMenuConfig:function(e){return d.person.loadConfig({item:e,personModel:e.userModels[0]})}},photo_comment_mention:{extractEntitiesFromResponse:function(e){return s(e).catch(function(e){console.log(e)})},setupView:function(e){return t.getView("base-notification-item-view",{activityItem:e}).then(function(e){return e.initialize()})},constructTemplateConfig:function(i){var o,a=i.activityEntityModels.photo,r=i.userModels;return o=i.activityData.countUsers>1?n.intlHTMLMessage({intlName:"notifications.NOTIF_X_PEOPLE_COMMENT_MENTIONED_YOU_1_PHOTO",personName:r[0].getValue("displayname"),personUrl:r[0].getValue("url"),personCountString:e.IntlNumber.format(i.activityData.countUsers,t.lang,1),commentsUrl:a.getValue("url")+"/#comments"}):n.intlHTMLMessage({intlName:"notifications.NOTIF_1_PERSON_COMMENT_MENTIONED_YOU_1_PHOTO",personName:r[0].getValue("displayname"),personUrl:r[0].getValue("url"),commentUrl:a.getValue("url")+"/#comments",commentContent:e.StringHelper.stripTags(i.eventDataList[0]._content)}),{headline:o,timestamp:i.timestamp,avatarData:{id:r[0].getValue("id"),type:"person",iconUrl:r[0].getValue("buddyicon").small,url:r[0].getValue("url")},photo:l(a)}},loadContextMenuConfig:function(e){return d.person.loadConfig({item:e,personModel:e.userModels[0]})}},gallery:{},gallery_comment:{},share:{},photo_accepted:{},photo_declined:{},photo_mention:{},group_blast:{},upload:{}};var f={extractEntitiesFromResponse:function(t){try{return c[t.type].extractEntitiesFromResponse(t)}catch(t){return e.Promise.resolve({})}},setupView:function(e){var t=e.type;try{return c[t].setupView(e)}catch(e){return}},getTemplateHtml:function(e){var t,i=e.type;try{return t=c[i].constructTemplateConfig(e),g.getTemplate(o[i])(t)}catch(e){return""}},loadContextMenuConfig:function(e){var t=e.type;return c[t].loadContextMenuConfig(e)},getContextMenuConfig:function(e){return d[e.contextMenuType].getConfig(e)},convertNotificationModel:function(e){return{id:e.getValue("id"),seen:e.getValue("isSeen"),isMuted:e.getValue("isMuted"),type:e.getValue("type"),timestamp:e.getValue("timestamp"),model:e,activityData:e.getValue("activityData"),eventDataList:e.getValue("eventDataList"),userModels:e.getValue("userModels"),activityEntityModels:e.getValue("activityEntityModels"),eventEntityModelsList:e.getValue("eventEntityModelsList")}}};return e.augment(f,e.EventTarget),f}},"@VERSION@",{requires:["event-custom","template-lib-helper","api-helper","intl-number","string-helper","base-notification-item-view","follow-notification-item-view","testimonial-notification-item-view","hermes-template-notification-core","hermes-template-notif-item-fave","hermes-template-notif-item-comment","hermes-template-notif-item-reply-reply","hermes-template-notif-item-group-topic-new","hermes-template-notif-item-contacted","hermes-template-notif-item-group-invite","hermes-template-notif-item-note","hermes-template-notif-item-tag","hermes-template-notif-item-people","hermes-template-notif-item-testimonial","hermes-template-notif-item-group-user-invite","hermes-template-notif-item-flickrmail","hermes-template-notif-item-photo-comment-mention","hermes-template-notif-item-gallery","hermes-template-notif-item-gallery-comment","hermes-template-notif-item-share","hermes-template-notif-item-photo-accepted","hermes-template-notif-item-photo-declined","hermes-template-notif-item-photo-mention","hermes-template-notif-item-group-blast","hermes-template-notif-item-upload"],langBundles:["common","relative-dates","notifications","profile","photo-card","header"]});YUI.add("hermes-lang-photo-card_fr-fr",function(e,s){e.Intl.add("hermes/photo-card","fr-FR",{SHARE_THIS_PHOTO:["Partager cette photo"],SEND_A_MESSAGE:["Envoyer un message"],FOLLOW_USER:['Suivre <span class="username-text">',"${username}","</span>"],UNFOLLOW_USER:['Ne plus suivre <span class="username-text">',"${username}","</span>"],BLOCK_USER:['Bloquer <span class="username-text">',"${username}","</span>"],UNBLOCK_USER:['Débloquer <span class="username-text">',"${username}","</span>"],SHARE_PHOTOSTREAM:["Partager le flux de photos"],SHARE_GROUP:["Partager le groupe"],JOIN_GROUP:["Rejoindre le groupe"],LEAVE_GROUP:["Quitter le groupe"],BLOCK_USER_QUESTION:['Bloquer <span class="username-text">',"${username}","</span> ?"],BLOCK_CONFIRM_MESSAGE:["Cet utilisateur ne pourra ni vous suivre, ni interagir avec vos photos ou vidéos, ni vous envoyer des mails Flickr. Tous les commentaires ou favoris qu’il a ajoutés à votre contenu seront supprimés et votre contenu sera retiré de ses galeries."],BLOCK_CONFIRM_MESSAGE_NOTE:["Remarque : le blocage proprement dit s’effectuera immédiatement, mais <b>le retrait des commentaires ou favoris peut mettre quelques heures</b> (espérons que ce sera plus rapide !)."],HIDE_FROM_ACTIVITY_FEED:["Ne pas afficher dans le flux d’activité"],SHOW_IN_ACTIVITY_FEED:["Afficher dans le flux d’activité"]})},"@VERSION@",{requires:["intl"]});YUI.add("hermes-lang-header_fr-fr",function(e,o){e.Intl.add("hermes/header","fr-FR",{EDIT_COVER_PHOTO:["Modifier la photo de couverture"],PHOTOSTREAM:["Galerie"],ALBUMS:["Albums"],FAVORITES:["Favoris"],CREATIONS:["Créations"],PHOTO_BOOKS:["Albums photo"],EDIT:["Modifier"],PUBLIC:["Public"],ALL:["Tous"],CHANGE_YOUR_BUDDY_ICON:["Modifier votre avatar"],CHANGE_YOUR_GROUP_ICON:["Changer votre icône de groupe"],MEMBER_SINCE:["Membre depuis"],GROUP_SINCE:["Groupe depuis"],MDY_DATE:[{type:"date",valueName:"mdyDate",format:"medium"}],PHOTOS:["Photos"],VIEWS:["Vues"],VIEW_ALL_ALBUMS:["Afficher tous les albums"],SEND_FLICKR_MAIL:["Envoyer un FlickrMail"],BLOCK:["Bloquer"],USERS_GOD_PAGE:["Page de l’utilisateur"],GROUP_GOD_PAGE:["Dieu"],ADMINISTRATION:["Administration"],DISCUSSIONS:["Discussions"],MEMBERS:["Membres"],MAP:["Carte"],ABOUT:["À propos"],INVITE:["Inviter des amis"],OVERVIEW:["Aperçu"],FULLSCREEN:["Plein écran"],SHARE_THIS_PAGE:["Partager cette page"],COMMENT:["Commenter"],MORE_ACTIONS:["Plus d’actions"],THUMBNAIL_VIEW:["Affichage miniatures"],GROUP_LIST:["Liste des groupes"],CREATE_GROUP:["Créer un groupe"],COVER_PHOTO_CHOOSE:["Choisir une photo de couverture"],COVER_PHOTO_UPLOAD:["Importez une photo"],COVER_PHOTO_SET_POSITION:["Faites glisser pour définir la position !"],COVER_PHOTO_SAVE:["Enregistrer"],COVER_PHOTO_CANCEL:["Annuler"],COVER_PHOTO_LIST_ERROR:["Nous rencontrons des problèmes pour répertorier vos photos. Patientez quelques instants et réessayez."],COVER_PHOTO_SELECT_ERROR:["Nous rencontrons des problèmes pour sélectionner cette photo. Patientez quelques instants et réessayez."],COVER_PHOTO_POSITION_ERROR:["Nous rencontrons des problèmes pour positionner cette photo. Patientez quelques instants et réessayez."],COVER_PHOTO_LOW_RESOLUTION:["Cette photo est petite et n’est pas adaptée pour une couverture."],COVER_PHOTO_NO_PHOTOS:["Désolé ! Il n’y a pas de photos.<br/>Mais ! Il ne faudrait quand même pas que nous prenions les photos à votre place ?!..."],GROUPS_HEADER:["Vos groupes"],GROUP_JOIN:["Rejoindre le groupe"],GROUP_JOINED:["Rejoint"],GROUP_JOIN_REQUESTED:["Participation demandée"],GROUP_LEAVE_GROUP:["Quitter le groupe"],GROUPS_OPT_OUT_MESSAGE:["Vous voyez la version beta de notre nouvelle expérience de groupes. Cliquez ici pour revenir à l’ancienne version."],GROUPS_OPT_IN_MESSAGE:["Revenir à l’expérience de groupe bêta."],STEAMPUNK_OCTOPUS:["Poulpe style Steampunk"],FOLLOWERS:[{type:"plural",valueName:"count",options:{one:"${#} abonné",other:"${#} abonnés"}}],FOLLOWING:[{type:"plural",valueName:"count",options:{one:"${#} Abonnement",other:"${#} abonnements"}}],FOLLOWER_COUNT:[{type:"plural",valueName:"count",options:{one:["${countString}"," abonné"],other:["${countString}"," abonnés"]}}],FOLLOWING_COUNT:[{type:"plural",valueName:"count",options:{one:["${countString}"," abonnement"],other:["${countString}"," abonnements"]}}],FOLLOWERS_SIMPLE:["Abonnés"],FOLLOWING_SIMPLE:["Abonnement"],JOINED_YEAR:["Date d'inscription : ","${year}"],COUNT_PHOTOS:[{type:"plural",valueName:"count",options:{one:"${#} photo",other:"${#} photos"}}],GUESTPASS_HISTORY:["Historique du partage"],POSITION_IMAGE:["Positionnez votre image"],MIN_ZOOM:["Vous ne pouvez plus faire de zoom arrière pour cette image"],GIFT_PRO:["Abonnement Pro en cadeau"],GIVE_PRO:["Offrez Pro"]})},"@VERSION@",{requires:["intl"]});YUI.add("notifications-list-view",function(t,i){require("hermes-core/flog")(i);t.namespace("Views")[this.name]=t.Base.create("notifications-list-view",t.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(i){this.params=i,this.isLoading=!0,this.pageNum=1,this.notificationsHelper=new t.NotificationsHelper(this.appContext),this.continuationToken="0"},loadState:function(){var t=this,i=this.appContext.getViewer();return this.appContext.getModel("person-notifications-models",i.nsid).then(function(i){t.notificationsModel=i})},buildContainer:function(){this.setContainerWithTemplate("notifications-list",{})},activate:function(){var i=this,n=this.get("container");return this.emptyStateNode=n.one(".notifications-empty-state"),this.flickrBallsNode=n.one(".loading-balls"),this.scrollContainer=n.one(".notifications-list"),this.listNode=n.one(".notification-item-list"),this.scrollContainerHeight=this.scrollContainer.get("clientHeight"),this.toggleLoading(!1),this.loadInitial().then(function(t){return i.appendItems(t)}).then(function(){i.registerEventHandler(i.scrollContainer.on("scroll",t.betterThrottle(i.handleScroll.bind(i),100,i,!1)))})},loadInitial:function(){return this.loadContinuated()},loadContinuated:function(){var t=this;return this.isLoadingMore=!0,this.toggleLoadingBalls(!0),this.notificationsModel.getNotificationsByContinuation({filter:this.notifFilter,continuation:this.continuationToken}).then(function(i){var n=i.notificationModels.map(function(i){return t.notificationsHelper.convertNotificationModel(i)});return t.continuationToken=i.continuation,t.isLoadingMore=!1,t.toggleLoadingBalls(!1),n}).catch(function(i){t.isLoadingMore=!1,t.toggleLoadingBalls(!1)})},appendItems:function(i){var n=this,o=[];return i.forEach(function(t){o.push(n.notificationsHelper.setupView(t))}),t.Promise.all(o).then(function(i){var o=[];return i.forEach(function(i){var e;i&&((e=t.Node.create('<li class="notification-item-list-item"></li>')).appendChild(i.get("container")),n.listNode.appendChild(e),o.push(i.activate()))}),t.Promise.all(o).then(function(){return i})})},toggleLoading:function(t){this.isLoading=t},toggleEmptyState:function(t){this.emptyStateNode.toggleClass("hidden",!t)},handleScroll:function(t){var i=this,n=this.scrollContainer.get("scrollTop"),o=this.scrollContainer.get("scrollHeight");!this.isLoadingMore&&n+this.scrollContainerHeight+100>o&&!this.isAtBottom&&this.loadContinuated().then(function(t){return i.appendItems(t)})},toggleLoadingBalls:function(t){this.flickrBallsNode.toggleClass("hidden",!t)}})},"@VERSION@",{requires:["flickr-view","hermes-template-notifications-list","notifications-helper"],langBundles:["common","notifications","relative-dates"]});YUI.add("notifications-menu-view",function(t){"use strict";t.namespace("Views")[this.name]=t.Base.create("notifications-menu-view",t.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this.pollingFailed=!1,this.shouldFetchNotifs=!0,this.notifFilter=["group_topic_new","user_gallery_comment"].join(","),""===this.get("container").get("innerHTML")&&this.setContainerWithTemplate("notifications-menu"),this},loadState:function(){var e=this,i=this.appContext.getViewer();return this.appContext.getModel("person-notifications-models",i.nsid).then(function(n){if(e.set("personNotificationsModel",n),Date.now()-n.getValue("unseenLastFetchedTimestamp")>t.config.flickr.notifications.loading_count_refetch_delay)return n.remoteReadUnseenNotificationCount({id:i.nsid,filter:e.notifFilter},e.appContext).then(null,function(t){e.pollingFailed=!0})})},buildContainer:function(){var t=this.formatCount99(this.get("personNotificationsModel").getValue("unseenNotificationCount"));return this.setContainerWithTemplate("notifications-menu",{unseenNotificationCount:t}),this},activate:function(){var e=this,i=e.get("personNotificationsModel");e.unseenBadge=e.get("container").one(".c-notification-unseencount"),e.unseenCount=0,e.notifIcon=e.get("container").one(".c-notification-icon"),0===i.getValue("unseenNotificationCount")?e.unseenBadge.addClass("hidden"):e.unseenBadge.removeClass("hidden"),t.on("notifications:closeNotificationsMenuClicked",function(t){e.droparound.close()}),this.registerEventHandler(this.get("container").on("click",e.openMenu.bind(e))),this.registerEventHandler(this.get("container").on("key",e.keyboardToggleMenu.bind(e),"down:13,32")),this.registerEventHandler(this.get("container").on("key",e.enterMenu.bind(e),"down:9,40")),e.pollForUnseenNotifs()},pollForUnseenNotifs:function(){this.pollIntervalId=setInterval(this.readUnseenNotifs.bind(this),t.config.flickr.notifications.polling_delay)},readUnseenNotifs:function(){var e=this,i=this.appContext.getViewer();e.get("personNotificationsModel").remoteReadUnseenNotificationCount({id:i.nsid,filter:e.notifFilter},e.appContext).then(function(t){e.shouldFetchNotifs=!0,t!==e.unseenCount&&(e.unseenCount=t,0!==t?(e.unseenBadge.removeClass("hidden"),e.unseenBadge.set("text",e.formatCount99(t))):e.unseenBadge.addClass("hidden"))},function(i){clearInterval(e.pollIntervalId),e.pollingFailed||(e.pollingFailedTimeoutId=setTimeout(e.pollForUnseenNotifs.bind(e),t.config.flickr.notifications.polling_failure_timeout)),e.pollingFailed=!0})},openMenu:function(){this.revealNotifications()},keyboardToggleMenu:function(t){t.preventDefault(),!this.droparound||this.droparound.isClosed?this.revealNotifications():this.droparound.close()},enterMenu:function(t){var e=t.keyCode;if(9===e&&!t.shiftKey&&"true"===t.target.getAttribute("aria-expanded")||40===e){t.preventDefault();var i=this.droparound.get("container").one("div.notifs-droparound");if(i){var n=i.one("a.mail-icon");this.registerEventHandler(n.on("key",this.enterNotificationsList.bind(this),"down:9,40")),n.focus()}}},enterNotificationsList:function(t){var e=t.keyCode;(9===e&&!t.shiftKey||40===e)&&(t.preventDefault(),this.droparound.get("subview").findFocus.call(this,this.droparound.get("container").one("div.notifs-droparound").one("ul").one("li:not(.hidden)")))},revealNotifications:function(){var e,i=this.appContext.viewportData.getWidth(),n=this.appContext.viewportData.getHeight(),o=i>700?60:67,s=i>700?"":i-2+"px",a=n>1e3?"800px":n-200+"px";this.appContext.flipper.isFlipped("enable-notifications-2020")?(e=new t.Views["notifications-list-view"]({appContext:this.appContext}),this.droparound=new t.Views.FluidDroparound({appContext:this.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!0,anchorOffsetVertical:-4,showDropArrow:!0,contentPadding:0,anchorElement:this.get("container").one(".c-notification-icon"),subview:e,observePageResize:!0,positionFixed:!0,autoSizeToContent:!0,preventPageScrollOnScroll:!0}),this.droparound.show(),this.unseenBadge.addClass("hidden"),this.shouldFetchNotifs=!1):((e=new t.Views["notifications-view"]({appContext:this.appContext,width:s,listHeight:a,shouldFetchNotifs:this.shouldFetchNotifs,notifFilter:this.notifFilter})).appContext=this.appContext,this.droparound=new t.Views.FluidDroparound({appContext:this.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!0,anchorOffsetVertical:-4,anchorOffsetHorizontal:o,mirrorArrowAdjustment:o-11,showDropArrow:!0,contentPadding:0,classList:"notifs-droparound no-border big-shadow",anchorElement:this.get("container").one(".c-notification-icon"),subview:e,observePageResize:!0,positionFixed:!0,autoSizeToContent:!0,preventPageScrollOnScroll:!0}),this.droparound.show(),this.unseenBadge.addClass("hidden"),this.shouldFetchNotifs=!1)},formatCount99:function(t){return t>=100?"99+":t},destructor:function(){clearInterval(this.pollIntervalId),clearTimeout(this.pollingFailedTimeoutId)}})},"@VERSION@",{requires:["flickr-view","hermes-template-notifications-menu","fluid-droparound-view","notifications-view","notifications-list-view"],langBundles:["notifications","common"]});