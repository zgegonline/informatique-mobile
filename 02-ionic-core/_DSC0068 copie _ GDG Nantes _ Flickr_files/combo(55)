YUI.add("person-notifications-models",function(t){function e(t){e.superclass.constructor.call(this,t)}t.Models[this.name]=e,t.extend(e,t.FlickrModelRegistry,{name:this.name,remote:{read:function(e){return t.ModelFetchers["flickr-people-getInfo"].run(e,this.appContext)},readUnseenNotificationCount:function(e,r){return t.ModelFetchers["flickr-activity-getNotificationsCount"].run(e,r)},updateMutedObjects:function(e,r){return t.ModelUpdaters["flickr-activity-muteObject"].run(e,r)},updateUnmutedObjects:function(e,r){return t.ModelUpdaters["flickr-activity-unmuteObject"].run(e,r)}},remoteReadUnseenNotificationCount:function(t,e,r){return this.setValue(t,"unseenLastFetchedTimestamp",Date.now()),this.remote.readUnseenNotificationCount(e,r)},remoteUpdateMutedObjects:function(t,e,r){var n=this;return this.remote.updateMutedObjects(e,r).then(function(e){return n.setValue(t,"muteChanged",!0),e})},remoteUpdateUnmutedObjects:function(t,e,r){var n=this;return this.remote.updateUnmutedObjects(e,r).then(function(e){return n.setValue(t,"muteChanged",!0),e})},getNotificationsByContinuation:function(e,r){var n=Object.assign(r,{id:e});return t.ListFetchers["flickr-activity-recentByType"].run(n,this.appContext)},attributes:{id:{setter:function(t){return t||this.appContext.getViewer().nsid}},unseenNotificationCount:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)},defaultValue:0},unreadFlickrMailCount:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)},defaultValue:0},unseenLastFetchedTimestamp:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)},defaultValue:0},muteChanged:{validator:function(e){return t.AttributeHelpers.validateBoolean(e)},setter:function(e){return t.AttributeHelpers.coerceBoolean(e)},defaultValue:!1},notifications:{isCollection:!0,pageFetch:{listFetcher:t.ListFetchers["flickr-activity-recentByType-OLD"]}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-activity-recentByType-fetcher","flickr-activity-recentByType-OLD-fetcher","flickr-notifications-markread-updater","flickr-people-getInfo-fetcher","flickr-activity-getNotificationsCount-fetcher","flickr-activity-muteObject-updater","flickr-activity-unmuteObject-updater","attribute-helpers"]});YUI.add("flickr-activity-recentByType-fetcher",function(e,t){"use strict";e.namespace("ListFetchers")["flickr-activity-recentByType"]={run:function(i,n){var o=this,s=this._processParams(i);return new e.FlickrPromise({apiResponse:n.callAPI("flickr.activity.recentByType",s),notificationModelRegistry:n.getModelRegistry("notification-models"),notificationsModelRegistry:n.getModelRegistry("person-notifications-models")}).then(function(e){return o._processResponse(e,i,s,n)},e.FetcherErrorLogger(t))},_processParams:function(t){var i={extras:["sizes","icon_urls","ignored","rev_ignored","tags","autotags","datecreate"].join(",")+","+e.APIHelper.request.getRebootPhotoExtras(),count:30,per_object:50};return"continuation"in t?i.continuation=t.continuation:"page"in t&&(i.page=t.page,i.per_page=t.perPage),i},_processResponse:function(t,i,n,o){var s=t.apiResponse,a=t.notificationModelRegistry,r=t.notificationsModelRegistry,c=[],p=new e.NotificationsHelper(o);return s.items.item.forEach(function(t){var i=t.events||[],n={id:e.guid(),isSeen:1===t.seen||!0===t.seen,isMuted:1===t.is_muted,type:t.type,timestamp:t.date,activityData:t,eventDataList:i};c.push(p.extractEntitiesFromResponse(n).then(function(n){var o={id:e.guid(),isSeen:1===t.seen||!0===t.seen,isMuted:1===t.is_muted,type:t.type,timestamp:t.date,activityData:t,eventDataList:i,userModels:n.userModels,activityEntityModels:n.activityEntityModels,eventEntityModelsList:n.eventEntityModelsList};return a.addOrUpdate(o)}))}),e.Promise.all(c).then(function(e){var t={id:i.id};return"continuation"in n?{notificationModels:e,continuation:s.continuation}:"page"in n?(r.exists(i.id)?r.getValue(i.id,"notifications").addPage({page:n.page,perPage:n.per_page,pageContent:e,totalItems:parseInt(s.items.total||0,10)}):(t.notifications=e,r.add(t)),e):void 0})}}},"@VERSION@",{requires:["flickr-promise","search-helper","querystring-parse-simple"],optional:["url-helper","notification-models","person-notifications-models","contact-models","photo-models","notification-models"]});YUI.add("hermes-template-notification-photo-extra-info",function(e,a){var n=e.Template.Handlebars.revive({1:function(e,a,n,t,i){return e.escapeExpression((n.intlMessage||a&&a.intlMessage||n.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{time:null!=a?a.time:a,intlName:null!=a?a.intlName:a},data:i}))},compiler:[7,">= 4.0.0"],main:function(e,a,n,t,i){var l;return'<span class="extra-info">\n\t'+(null!=(l=(n.friendlySinceDate||a&&a.friendlySinceDate||n.helperMissing).call(null!=a?a:{},null!=(l=null!=a?a.event:a)?l.timestamp:l,!0,!0,{name:"friendlySinceDate",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))?l:"")+"\n</span>"},useData:!0}),t={};e.Array.each([],function(a){var n=e.Template.get("hermes/"+a);n&&(t[a]=n)}),e.Template.register("hermes/notification-photo-extra-info",function(a,i){return i=i||{},i.partials=i.partials?e.merge(t,i.partials):t,n(a,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-notification-photo-comment",function(l,n){var e=l.Template.Handlebars.revive({1:function(l,n,e,a,t){var o;return null!=(o=e.if.call(null!=n?n:{},null!=n?n.subPeopleCount:n,{name:"if",hash:{},fn:l.program(2,t,0),inverse:l.program(4,t,0),data:t}))?o:""},2:function(l,n,e,a,t){var o;return"\t\t\t\t"+l.escapeExpression((e.intlHTMLMessage||n&&n.intlHTMLMessage||e.helperMissing).call(null!=n?n:{},{name:"intlHTMLMessage",hash:{mediaType:null!=(o=null!=n?n.object:n)?o.mediaType:o,objectUrl:null!=(o=null!=n?n.object:n)?o.url:o,secondPersonUrl:null!=(o=null!=(o=null!=n?n.people:n)?o[1]:o)?o.url:o,secondPersonName:null!=(o=null!=(o=null!=n?n.people:n)?o[1]:o)?o.name:o,firstPersonUrl:null!=(o=null!=(o=null!=n?n.people:n)?o[0]:o)?o.url:o,firstPersonName:null!=(o=null!=(o=null!=n?n.people:n)?o[0]:o)?o.name:o,count:null!=n?n.subPeopleCount:n,intlName:"notifications.NOTIF_PHOTO_COMMENT_YOURS_MULTI"},data:t}))+"\n"},4:function(l,n,e,a,t){var o;return"\t\t\t\t"+l.escapeExpression((e.intlHTMLMessage||n&&n.intlHTMLMessage||e.helperMissing).call(null!=n?n:{},{name:"intlHTMLMessage",hash:{mediaType:null!=(o=null!=n?n.object:n)?o.mediaType:o,objectUrl:null!=(o=null!=n?n.object:n)?o.url:o,personUrl:null!=(o=null!=(o=null!=n?n.people:n)?o[0]:o)?o.url:o,personName:null!=(o=null!=(o=null!=n?n.people:n)?o[0]:o)?o.name:o,intlName:"notifications.NOTIF_PHOTO_COMMENT_YOURS"},data:t}))+"\n"},6:function(l,n,e,a,t){var o;return null!=(o=e.if.call(null!=n?n:{},null!=n?n.subPeopleCount:n,{name:"if",hash:{},fn:l.program(7,t,0),inverse:l.program(9,t,0),data:t}))?o:""},7:function(l,n,e,a,t){var o;return"\t\t\t\t"+l.escapeExpression((e.intlHTMLMessage||n&&n.intlHTMLMessage||e.helperMissing).call(null!=n?n:{},{name:"intlHTMLMessage",hash:{ownerName:null!=(o=null!=(o=null!=n?n.object:n)?o.owner:o)?o.displayname:o,ownerUrl:null!=(o=null!=(o=null!=n?n.object:n)?o.owner:o)?o.url:o,mediaType:null!=(o=null!=n?n.object:n)?o.mediaType:o,objectUrl:null!=(o=null!=n?n.object:n)?o.url:o,secondPersonUrl:null!=(o=null!=(o=null!=n?n.people:n)?o[1]:o)?o.url:o,secondPersonName:null!=(o=null!=(o=null!=n?n.people:n)?o[1]:o)?o.name:o,firstPersonUrl:null!=(o=null!=(o=null!=n?n.people:n)?o[0]:o)?o.url:o,firstPersonName:null!=(o=null!=(o=null!=n?n.people:n)?o[0]:o)?o.name:o,count:null!=n?n.subPeopleCount:n,intlName:"notifications.NOTIF_PHOTO_COMMENT_OTHER_MULTI"},data:t}))+"\n"},9:function(l,n,e,a,t){var o;return"\t\t\t\t"+l.escapeExpression((e.intlHTMLMessage||n&&n.intlHTMLMessage||e.helperMissing).call(null!=n?n:{},{name:"intlHTMLMessage",hash:{ownerName:null!=(o=null!=(o=null!=n?n.object:n)?o.owner:o)?o.displayname:o,ownerUrl:null!=(o=null!=(o=null!=n?n.object:n)?o.owner:o)?o.url:o,mediaType:null!=(o=null!=n?n.object:n)?o.mediaType:o,objectUrl:null!=(o=null!=n?n.object:n)?o.url:o,personUrl:null!=(o=null!=(o=null!=n?n.people:n)?o[0]:o)?o.url:o,personName:null!=(o=null!=(o=null!=n?n.people:n)?o[0]:o)?o.name:o,intlName:"notifications.NOTIF_PHOTO_COMMENT_OTHER"},data:t}))+"\n"},compiler:[7,">= 4.0.0"],main:function(l,n,e,a,t){var o;return'<div class="details">\n\t<span class="headline">\n'+(null!=(o=e.if.call(null!=n?n:{},null!=(o=null!=(o=null!=n?n.object:n)?o.owner:o)?o.isMe:o,{name:"if",hash:{},fn:l.program(1,t,0),inverse:l.program(6,t,0),data:t}))?o:"")+"\t</span>\n\n"+(null!=(o=l.invokePartial(a["notification-photo-extra-info"],n,{name:"notification-photo-extra-info",data:t,indent:"\t",helpers:e,partials:a,decorators:l.decorators}))?o:"")+"</div>"},usePartial:!0,useData:!0}),a={};l.Array.each(["notification-photo-extra-info"],function(n){var e=l.Template.get("hermes/"+n);e&&(a[n]=e)}),l.Template.register("hermes/notification-photo-comment",function(n,t){return t=t||{},t.partials=t.partials?l.merge(a,t.partials):a,e(n,t)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-notification-photo-extra-info"]});YUI.add("hermes-template-notification-group-invite",function(e,a){var t=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,a,t,n,i){var l,r=e.lambda,o=e.escapeExpression;return'<a class="avatar group tiny no-menu" style="background-image: url('+o(r(null!=(l=null!=a?a.object:a)?l.bestIconURL:l,a))+');" href="'+o(r(null!=(l=null!=a?a.object:a)?l.url:l,a))+'"></a>\n\n<div class="details">\n\t<span class="headline">\n\t\t'+o((t.intlHTMLMessage||a&&a.intlHTMLMessage||t.helperMissing).call(null!=a?a:{},{name:"intlHTMLMessage",hash:{groupUrl:null!=(l=null!=a?a.object:a)?l.url:l,groupName:null!=(l=null!=a?a.object:a)?l.title:l,intlName:"notifications.NOTIF_GROUP_USER_INVITE"},data:i}))+"\n\t</span>\n\n"+(null!=(l=e.invokePartial(n["notification-photo-extra-info"],a,{name:"notification-photo-extra-info",data:i,indent:"\t",helpers:t,partials:n,decorators:e.decorators}))?l:"")+"</div>\n"},usePartial:!0,useData:!0}),n={};e.Array.each(["notification-photo-extra-info"],function(a){var t=e.Template.get("hermes/"+a);t&&(n[a]=t)}),e.Template.register("hermes/notification-group-invite",function(a,i){return i=i||{},i.partials=i.partials?e.merge(n,i.partials):n,t(a,i)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-notification-photo-extra-info"]});YUI.add("hermes-template-notification-added-to-gallery",function(l,e){var n=l.Template.Handlebars.revive({1:function(l,e,n,a,t){var r;return"\t\t\t"+l.escapeExpression((n.intlHTMLMessage||e&&e.intlHTMLMessage||n.helperMissing).call(null!=e?e:{},{name:"intlHTMLMessage",hash:{count:null!=e?e.subCount:e,mediaType:null!=(r=null!=e?e.object:e)?r.mediaType:r,objectUrl:null!=(r=null!=e?e.object:e)?r.url:r,secondGalleryUrl:null!=(r=null!=(r=null!=(r=null!=e?e.events:e)?r[1]:r)?r.gallery:r)?r.url:r,secondGalleryName:null!=(r=null!=(r=null!=(r=null!=e?e.events:e)?r[1]:r)?r.gallery:r)?r.title:r,galleryUrl:null!=(r=null!=(r=null!=e?e.event:e)?r.gallery:r)?r.url:r,galleryName:null!=(r=null!=(r=null!=e?e.event:e)?r.gallery:r)?r.title:r,intlName:"notifications.NOTIF_GALLERY_MULTI"},data:t}))+"\t\n"},3:function(l,e,n,a,t){var r;return"\t\t\t"+l.escapeExpression((n.intlHTMLMessage||e&&e.intlHTMLMessage||n.helperMissing).call(null!=e?e:{},{name:"intlHTMLMessage",hash:{mediaType:null!=(r=null!=e?e.object:e)?r.mediaType:r,objectUrl:null!=(r=null!=e?e.object:e)?r.url:r,galleryUrl:null!=(r=null!=(r=null!=e?e.event:e)?r.gallery:r)?r.url:r,galleryName:null!=(r=null!=(r=null!=e?e.event:e)?r.gallery:r)?r.title:r,intlName:"notifications.NOTIF_GALLERY"},data:t}))+"\n"},compiler:[7,">= 4.0.0"],main:function(l,e,n,a,t){var r,i,u=l.lambda,s=l.escapeExpression,o=null!=e?e:{};return'<a class="avatar gallery tiny no-menu" style="background-image: url('+s(u(null!=(r=null!=(r=null!=(r=null!=e?e.event:e)?r.gallery:r)?r.iconurls:r)?r.small:r,e))+');" href="'+s(u(null!=(r=null!=(r=null!=e?e.event:e)?r.gallery:r)?r.url:r,e))+'"></a>\n\n<div class="details">\n\t<span class="headline">\n'+(null!=(r=n.if.call(o,null!=e?e.subCount:e,{name:"if",hash:{},fn:l.program(1,t,0),inverse:l.program(3,t,0),data:t}))?r:"")+"\t</span>\n\n"+(null!=(r=l.invokePartial(a["notification-photo-extra-info"],e,{name:"notification-photo-extra-info",data:t,indent:"\t",helpers:n,partials:a,decorators:l.decorators}))?r:"")+'</div>\n\n<a class="avatar '+s("function"==typeof(i=null!=(i=n.type||(null!=e?e.type:e))?i:n.helperMissing)?i.call(o,{name:"type",hash:{},data:t}):i)+' small" style="background-image: url('+s(u(null!=(r=null!=(r=null!=(r=null!=e?e.object:e)?r.sizes:r)?r.sq:r)?r.url:r,e))+');" href="'+s(u(null!=(r=null!=e?e.object:e)?r.url:r,e))+'"></a>\n'},usePartial:!0,useData:!0}),a={};l.Array.each(["notification-photo-extra-info"],function(e){var n=l.Template.get("hermes/"+e);n&&(a[e]=n)}),l.Template.register("hermes/notification-added-to-gallery",function(e,t){return t=t||{},t.partials=t.partials?l.merge(a,t.partials):a,n(e,t)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-notification-photo-extra-info"]});