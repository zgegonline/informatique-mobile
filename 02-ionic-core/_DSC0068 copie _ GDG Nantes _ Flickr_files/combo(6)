YUI.add("moola-manager",function(t,e){"use strict";function o(e,o){var i;this.initialAdShown=!1,this.adCouldBeShown=!1,this.dwellTime=0,this.contextOwnerIsPro=!1,this.origin={},this.context={},this.timeoutID=0,this.adCallsCounter=0,this.currentlyShowingAd=!1,this.adPosition=1,e&&o?(this.referrer=e,this.appContext=o):r.error("Attempt to instantiate moola-manager without appContext/referrer"),i=function(e){var o={};e.origin===t.url()&&"string"==typeof e.data&&e.data.split&&(e.data.split("&").map(function(t){var e=t.split("=");o[e[0]]=e[1]}),"true"===o.no_ad?t.fire("no_ad_event",o.ad_id):t.fire("ad_event",o.ad_id))},t.config.win&&t.config.win.addEventListener("message",i,!1)}var r=require("hermes-core/flog")(e);o.prototype.markAdAsSeen=function(){this.initialAdShown=!0,this.resetPhotoAdsCounter(),this.adCallsCounter--},o.prototype.beaconDwellTime=function(){var e=Date.now()-this.dwellTime;this.dwellTime=0,t.rapidTracker.beacon(this.name,"adDwellTime",{dwell:e})},o.prototype.adIsUnloading=function(){this.beaconDwellTime(),clearTimeout(this.timeoutID),this.currentlyShowingAd=!1},o.prototype.adIsLoading=function(){this.currentlyShowingAd=!0},o.prototype.isEnabled=function(){var t=this.appContext.getViewer().signedIn,e=this.appContext.getViewer().signedIn&&this.appContext.getViewer().isPro;return!(this.appContext.forceServerRender||this.appContext.flipper.isFlipped("moola_killswitch")||!this.appContext.flipper.isFlipped("enable-photopage-interstitial-ad")||t&&e||t&&!e&&!this.appContext.flipper.isFlipped("enable-photopage-interstitial-ad-for-signedin-free-users"))},o.prototype.adNext=function(){var e,o,r,i,n,a;return!(YUI.Env.isServer||!this.context.current)&&(this.adPosition++,e=this.isEnabled(),o=this.adCouldBeShown,i=this.enoughPhotoViewsAccrued(),r=this.contextOwnerIsPro,n=this.adjacentPhotosAreAdFriendly(),a=this.referrerIsBlacklisted(),e&&o&&i&&!r&&n&&!a&&t.rapidTracker.beacon(this.name,"adSlotAvailable"),e&&o&&!r&&i&&n&&!a)},o.prototype.resetPhotoAdsCounter=function(){this.appContext.cookieCatcher.setCookieIfAllowed("adCounter",0,{path:"/",domain:"flickr.com"})},o.prototype.enoughPhotoViewsAccrued=function(){var e=t.Cookie.get("adCounter",Number),o=this.getThreshold();return(e=e||0)>=o},o.prototype.adjacentPhotosAreAdFriendly=function(){return"next"===this.origin.arrow?this.context.next.adFriendly&&this.context.current.adFriendly:this.context.previous.adFriendly&&this.context.current.adFriendly},o.prototype.referrerIsBlacklisted=function(){var t=[];return this.appContext.getViewer().signedIn||t.push("/"),t.indexOf(this.appContext.getPreviousURL())>-1},o.prototype.setAdCouldBeShown=function(t,e,o){void 0===t&&(t=!1),e&&o?(this.origin.arrow=e,this.origin.url=o):t&&(r.info("Attempt to schedule an ad without setting nav direction or URL"),t=!1),this.adCouldBeShown=t},o.prototype.updateContext=function(e){var o;this.contextOwnerIsPro=!1,(-1!==t.Array.indexOf(["photostream-models","set-models","photoList-models"],e.type)||/^\/search\/\?.+=[0-9]+@N[0-9]{2}.*/.test(e.entryURL))&&(o=e.current.getValue("owner"))&&(this.contextOwnerIsPro=o.getValue("isPro")),this.context.previous=this.extractKeyDataFromPhotoModel(e.prev),this.context.current=this.extractKeyDataFromPhotoModel(e.current),this.context.next=this.extractKeyDataFromPhotoModel(e.next)},o.prototype.getThreshold=function(){var e;try{e=this.initialAdShown?t.config.flickr.moola.threshold[this.referrer].subsequent:t.config.flickr.moola.threshold[this.referrer].initial}catch(t){r.info("There is no matching value for referrer in the ad/referrer config",{referrer:this.referrer,err:t}),e=100}return e},o.prototype.updatePhotoAdsCounter=function(){var e=t.Cookie.get("adCounter",Number);return e=e||0,this.appContext.cookieCatcher.setCookieIfAllowed("adCounter",++e,{path:"/",domain:"flickr.com"}),e},o.prototype.extractKeyDataFromPhotoModel=function(t){var e={};return t&&(e={adFriendly:0===t.getValue("safetyLevel"),url:this.getBackgroundImage(t),link:t.getValue("url")}),e},o.prototype.getBackgroundImage=function(t){var e,o,r,i={height:40,width:101};return o=this.appContext.getViewer().getPixelRatio(),e={width:i.width*o,height:i.height*o},r={cropToFit:!0,includeSizes:["sq","t","q","s","n"]},t.getSizeToFit(e,r).url},t.namespace("AdManager"),t.AdManager=o},"@VERSION@",{requires:["cookie","io-base","json-parse","murmurhash","url"]});YUI.add("viewport-data",function(t){"use strict";var i=function(i){var e,o,n,r=this;r.appContext=i,(e=i.getCookie("vp"))&&((o=e.split(",")).length>4?(this.containerWidths=o.slice(4),this.containerWidths=this.containerWidths.map(function(t){return n=t.split(":"),{name:n[0],width:n[1]}})):this.containerWidths=[]),YUI.Env.isServer?e?(this.viewport={width:parseInt(o[0],10),height:parseInt(o[1],10)},this.density=o[2]?parseFloat(o[2]):1,this.scrollbarWidth=o[3]?parseInt(o[3],10):16):(this.viewport={width:0,height:0},this.density=1,this.scrollbarWidth=16,this.containerWidths=[]):(t.config.win&&(r.density=t.config.win.devicePixelRatio||1,r.scrollbarWidth=t.OverflowHelper.detectScrollbarSize(t.one("body"))),r.setCookieWithCurrentViewportRegion(),r.containerWidths||(r.containerWidths=[]),t.globalEvents.subscribe("window:resize",function(t){r.setCookieWithCurrentViewportRegion()}))};i.VIEWPORT_COOKIE_NAME="vp",i.MAX_NUM_CONTAINER_WIDTHS=20,i.prototype.setCookie=function(){var i,e;!this.viewport.width||this.viewport.width<0||!this.viewport.height||this.viewport.height<0||(i=this.viewport.width+","+this.viewport.height+","+this.density+","+this.scrollbarWidth,t.Lang.isArray(this.containerWidths)&&(e=this.containerWidths.reduce(function(t,i,e,o){return t+=i.name+":"+i.width,e<o.length-1&&(t+=","),t},""))&&(i=i+","+e),this.appContext.setCookie({cookieName:"vp",cookieValue:i,path:"/",expiresMonthsFromNow:1}))},i.prototype.setCookieWithCurrentViewportRegion=function(){this.viewport=t.DOM.viewportRegion(),this.setCookie()},i.prototype.getWidth=function(){return this.viewport.width},i.prototype.getHeight=function(){return this.viewport.height},i.prototype.getDevicePixelRatio=function(){return this.density},i.prototype.getScrollbarWidth=function(){return this.scrollbarWidth},i.prototype.getCommonMobileViewportWidth=function(){return 320},i.prototype.getContainerWidth=function(t){var i=0;return this.containerWidths.some(function(e){if(e.name===t)return i=parseInt(e.width,10),!0}),i},i.prototype.setContainerWidth=function(t,e){this.containerWidths.length>=i.MAX_NUM_CONTAINER_WIDTHS&&(this.containerWidths=this.containerWidths.slice(this.containerWidths.length-i.MAX_NUM_CONTAINER_WIDTHS+1)),this.containerWidths.some(function(i){if(i.name===t)return i.width=e,!0})||this.containerWidths.push({name:t,width:e}),this.setCookie()},t.ViewportData=i},"@VERSION@");YUI.add("querystring-parse-simple",function(e,t){var n=e.namespace("QueryString");n.parse=function(e,t,r){t=t||"&",r=r||"=";for(var i={},s=0,o=e.split(t),u=o.length,a;s<u;s++)a=o[s].split(r),a.length>0&&(i[n.unescape(a.shift())]=n.unescape(a.join(r)));return i},n.unescape=function(e){return decodeURIComponent(e.replace(/\+/g," "))}},"3.16.0",{requires:["yui-base"]});
YUI.add("browser-support",function(e,o){var r="Google Page Speed Insights",i=new RegExp(["UP\\.Link","UP\\.Browser","Profile\\/MIDP-","MMP\\/","NetFront","BlackBerry","Danger hiptop","Windows CE","MMP\\/","MIDP","Palm","Nokia","Symbian","iPhone","iPod","Android.+Mobile","Mobile.+Firefox","BB10.+Mobile","webOS","SAMSUNG.+Mobile Safari","SEC_.+Mobile Safari",r+".+Mobile"].join("|"),"i"),n=new RegExp([r].join("|"),"i"),t=new RegExp(["Edge"].join("|"),"i"),s=["facebot","facebook","facebookexternalhit","twitterbot","twitter","pinterest"],a=["bot","crawl","slurp","spider"],u=new RegExp(["Mediapartners-Google","AdsBot-Google","Googlebot","Google Favicon"].join("|"),"i"),c=/Windows NT (?:(?:4|5)\.\d|6\.(?:0|1))/i,f=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i,d="Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 10.0; WOW64; Trident/7.0; .NET4.0C; .NET4.0E; .NET CLR 2.0.50727; .NET CLR 3.0.30729; .NET CLR 3.5.30729)",l=function(e){var o;try{o=YUI.Env.parseUA(e)}catch(e){}return o&&o.userAgent?o.userAgent.toLowerCase():""},p=function(e,o){var r,i=!1;if(void 0===e||""===e)return!0;if(o)for(r in o)void 0!==o[r]&&!isNaN(o[r])&&o[r]>0&&(i=!0);return!i};e.mix(e.namespace("BrowserSupport"),{isUnsupportedBrowser:function(e){var o,r=!1;try{o=YUI.Env.parseUA(e)}catch(e){}return!p(e,o)&&(o.safari>=536||o.chrome>=20||o.gecko>=24||o.opera>=15||"android"===o.os||"ios"===o.os&&o.ios>=6||o.ie>11||(r=!0),n.test(o.userAgent)&&(r=!1),e===d||r)},isReallyUnsupportedBrowser:function(e){var o,r=!1;try{o=YUI.Env.parseUA(e)}catch(e){}return!p(e,o)&&(o.safari>=533.21||o.chrome>=13||o.gecko>=2||(e||"").indexOf("Firefox/4.0")>-1||o.opera>=12||"android"===o.os||"ios"===o.os&&o.ios>=4||o.ie>=9||(r=!0),e!==d&&r)},isMobileBrowser:function(e){try{var o=YUI.Env.parseUA(e);return!o.ipad&&((!o.mobile||!/Nexus 10/.test(o.userAgent))&&(!!o.mobile||i.test(o.userAgent)))}catch(e){}return!1},isMobileOrTablet:function(e){try{var o=YUI.Env.parseUA(e);return!!o.mobile||i.test(o.userAgent)}catch(e){}return!1},isBot:function(e){var o,r=!1;return o=l(e),a.some(function(e){return o.indexOf(e)>-1&&(r=!0,!0)}),r},isSharingBot:function(e){var o,r=!1;return o=l(e),s.some(function(e){return o.indexOf(e)>-1&&(r=!0,!0)}),r},isFacebook:function(e){var o=!1;return l(e).indexOf("facebookexternalhit/1.1")>-1&&(o=!0),o},isGoogle:function(e){return u.test(l(e))},getOSString:function(e){var o,r="";try{o=YUI.Env.parseUA(e)}catch(e){}return e&&e.indexOf("Windows Phone")>-1?r="windows":o&&o.os&&(r=o.os.toLowerCase()),r},isWebview:function(e){return f.test(e)},isGooglePageSpeedToolMobile:function(e){return new RegExp(r+".+Mobile").test(e)},isGooglePageSpeedToolDesktop:function(e){return new RegExp(r).test(e)},isEdge:function(e){return new RegExp(t).test(e)},isOldWindows:function(e){return c.test(e)}})},"@VERSION@",{requires:[]});YUI.add("pluginhost-base",function(e,t){function r(){this._plugins={}}var n=e.Lang;r.prototype={plug:function(e,t){var r,i,s;if(n.isArray(e))for(r=0,i=e.length;r<i;r++)this.plug(e[r]);else e&&!n.isFunction(e)&&(t=e.cfg,e=e.fn),e&&e.NS&&(s=e.NS,t=t||{},t.host=this,this.hasPlugin(s)?this[s].setAttrs&&this[s].setAttrs(t):(this[s]=new e(t),this._plugins[s]=e));return this},unplug:function(e){var t=e,r=this._plugins;if(e)n.isFunction(e)&&(t=e.NS,t&&(!r[t]||r[t]!==e)&&(t=null)),t&&(this[t]&&(this[t].destroy&&this[t].destroy(),delete this[t]),r[t]&&delete r[t]);else for(t in this._plugins)this._plugins.hasOwnProperty(t)&&this.unplug(t);return this},hasPlugin:function(e){return this._plugins[e]&&this[e]},_initPlugins:function(e){this._plugins=this._plugins||{},this._initConfigPlugins&&this._initConfigPlugins(e)},_destroyPlugins:function(){this.unplug()}},e.namespace("Plugin").Host=r},"3.16.0",{requires:["yui-base"]});
YUI.add("pluginhost-config",function(e,t){var n=e.Plugin.Host,r=e.Lang;n.prototype._initConfigPlugins=function(t){var n=this._getClasses?this._getClasses():[this.constructor],r=[],i={},s,o,u,a,f;for(o=n.length-1;o>=0;o--)s=n[o],a=s._UNPLUG,a&&e.mix(i,a,!0),u=s._PLUG,u&&e.mix(r,u,!0);for(f in r)r.hasOwnProperty(f)&&(i[f]||this.plug(r[f]));t&&t.plugins&&this.plug(t.plugins)},n.plug=function(t,n,i){var s,o,u,a;if(t!==e.Base){t._PLUG=t._PLUG||{},r.isArray(n)||(i&&(n={fn:n,cfg:i}),n=[n]);for(o=0,u=n.length;o<u;o++)s=n[o],a=s.NAME||s.fn.NAME,t._PLUG[a]=s}},n.unplug=function(t,n){var i,s,o,u;if(t!==e.Base){t._UNPLUG=t._UNPLUG||{},r.isArray(n)||(n=[n]);for(s=0,o=n.length;s<o;s++)i=n[s],u=i.NAME,t._PLUG[u]?delete t._PLUG[u]:t._UNPLUG[u]=i}}},"3.16.0",{requires:["pluginhost-base"]});
YUI.add("base-pluginhost",function(e,t){var n=e.Base,r=e.Plugin.Host;e.mix(n,r,!1,null,1),n.plug=r.plug,n.unplug=r.unplug},"3.16.0",{requires:["base-base","pluginhost"]});
YUI.add("template-base",function(e,t){function n(t,n){this.defaults=n,this.engine=t||e.Template.Micro,this.engine||e.error("No template engine loaded.")}n._registry={},n.register=function(e,t){return n._registry[e]=t,t},n.get=function(e){return n._registry[e]},n.render=function(t,r,i){var s=n._registry[t],o="";return s?o=s(r,i):e.error('Unregistered template: "'+t+'"'),o},n.prototype={compile:function(t,n){return n=n?e.merge(this.defaults,n):this.defaults,this.engine.compile(t,n)},precompile:function(t,n){return n=n?e.merge(this.defaults,n):this.defaults,this.engine.precompile(t,n)},render:function(t,n,r){return r=r?e.merge(this.defaults,r):this.defaults,this.engine.render?this.engine.render(t,n,r):this.engine.compile(t,r)(n,r)},revive:function(t,n){return n=n?e.merge(this.defaults,n):this.defaults,this.engine.revive?this.engine.revive(t,n):t}},e.Template=e.Template?e.mix(n,e.Template):n},"3.16.0",{requires:["yui-base"]});
YUI.add("history-helper",function(t,e){var r=require("hermes-core/flog")(e);t.HistoryHelper={setData:function(t,e,i){var o={};if("undefined"!=typeof history&&history.replaceState){void 0!==history.state&&null!==history.state&&void 0!==history.state.flickr&&(o=history.state.flickr),void 0===o[t]&&(o[t]={}),o[t][e]=i;try{history.replaceState({flickr:o},"")}catch(t){}return!0}return r.warn("Failed attempt to store history data",{namespace:t,key:e}),!1},getData:function(t,e){var r;if("undefined"!=typeof history&&void 0!==history.state&&null!==history.state&&void 0!==history.state.flickr&&void 0!==(r=history.state.flickr[t])&&void 0!==r[e])return r[e]}}},"@VERSION@",{requires:[]});YUI.add("flickr-view",function(e,i){var t=require("hermes-core/flog")(i),r=require("hermes-core/fletrics");e.FlickrView=e.Base.create("flickrView",e.Base,[],{viewState:null,subviews:{},subviewConfig:null,_eventHandles:null,initializer:function(e){return this.appContext=e.appContext,delete e.appContext,""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this.set("headContainer",""),this.isBuilt=!1,this.isActivated=!1,this.isErrorBuilt=!1,this.subviewsWithLoadingError={},this._params=e||{},this.isMobile=e.isMobile,this.subviews={},this._eventHandles=[],this.appContext&&!this.appContext.viewTiming&&(this.appContext.viewTiming={}),this.appContext&&(this.appContext.viewTiming[this.name]={initialize:0,loadState:0,buildContainer:0,buildHeadContainer:0,activate:0}),this},initialize:function(i){var n=this;return this.initializeStartTime=Date.now(),this.isErrorBuilt=!1,this.serverRendered=!(!i||!i.serverRendered)&&i.serverRendered,n.beforeDestroy&&(n.beforeDestroyHandler=n.before("destroy",n.beforeDestroy)),YUI.Env.isServer||this.registerEventHandler(this.appContext.flapp.after("activeViewChange",function(e){n.normalizedActivate()})),this.on("parentViewEvent",this.handleParentViewEvent.bind(this,this.name)),this.setupSubviews().then(function(){var e,i;if(n.isErrorBuilt){if(n.error.is404)throw n.error;throw i=new Error("Subview of "+n.name+" causing loadState error"),n.error&&(i.message+=": "+n.error.message,n.error.method&&(i.message+=", method="+n.error.method),i.message+=" | subview failure: "+n.error.fatal,n.error.wasDealbreaker&&(i.message+=" dealbreaker failed "),n.error.wasMultipleSubviews&&(i.message+=" multiple subviews failed "),i.fatal=n.error.fatal),i}if(n.loadStateTimingStart=Date.now(),!(e=n.loadState()))throw new Error("View "+n.name+" loadState function does not return a promise");return e}).then(function(){if(n.appContext&&n.appContext.viewTiming&&n.appContext.viewTiming[n.name]&&(n.appContext.viewTiming[n.name].loadState=Date.now()-n.loadStateTimingStart),YUI.Env.isServer||!n.get("container").hasClass("requiredToShowOnServer")||i&&i.wasDeferred){var e=Date.now();try{n.buildContainer()}catch(e){throw t.error("Error building",{topic:n.name,err:e}),n.fire("loadingError",{message:e.message,fatal:!0,wasDealbreaker:!0}),n.buildErrorContainer(),n.isErrorBuilt=!0,e}if(n.appContext&&n.appContext.viewTiming&&n.appContext.viewTiming[n.name]&&(n.appContext.viewTiming[n.name].buildContainer=Date.now()-e),n.get("isRootView")){n._buildFullRootViewAdditionalViewClasses();var r=n.get("rootViewAdditionalViewClasses");r&&r.length>0&&n.get("container").addClass(r.join(" "))}}n.isBuilt=!0,n.isErrorBuilt=!1,n.fire("loadingSuccess")},function(e){throw n.fire("loadingError",{message:e.message,fatal:e.fatal,is404:e.is404,wasMultipleSubviews:e.wasMultipleSubviews,wasDealbreaker:e.wasDealbreaker}),n.buildErrorContainer(),n.isErrorBuilt=!0,t.error("Error loading state",{topic:n.name,err:e}),e}).then(function(){var e,i;return n.isErrorBuilt||n.get("isActiveViewAgnostic")||(e=Date.now(),n._buildFullHeadMeta(),n.buildHeadContainer=Date.now()-e),YUI.Env.isServer||(n.shouldDeferSubviews&&n._setupDeferredSubviewsInitialization(),i=Date.now(),n.normalizedActivate(),n.appContext&&n.appContext.viewTiming&&n.appContext.viewTiming[n.name]&&(n.appContext.viewTiming[n.name].activate=Date.now()-i)),n.appContext&&n.appContext.viewTiming&&n.appContext.viewTiming[n.name]&&(n.appContext.viewTiming[n.name].initialize=Date.now()-n.initializeStartTime),!YUI.Env.isServer&&n._params.logViewTimings&&n.wasRequiredToShow&&r.set(n.name.replace(/\-/g,".")+".viewtiming",n.appContext.viewTiming[n.name].initialize),n},function(e){throw YUI.Env.isServer||(n.shouldDeferSubviews&&n._setupDeferredSubviewsInitialization(),n.normalizedActivate()),e}).catch(e.PromiseCatcher(this.name))},render:function(){return this},buildHeadContainer:function(){return this.set("headContainer",""),this},_buildSubviewHeadContainers:function(){var e=[],i=this;return Object.keys(this.subviews).forEach(function(t){-1===e.indexOf(i.subviews[t].get("headContainer"))&&e.push(i.subviews[t].get("headContainer"))}),e.sort(function(e,i){var t=e.toLowerCase().indexOf("<script")>-1,r=i.toLowerCase().indexOf("<script")>-1;return t&&!r?1:!t&&r?-1:0}).join("")},_buildFullHeadMeta:function(){var e;return this.buildHeadContainer(),e=this.get("headContainer"),e=e.concat(this._buildSubviewHeadContainers()),this.set("headContainer",e.concat("")),this},setRootViewAdditionalViewClasses:function(){return this.set("rootViewAdditionalViewClasses",[]),this},_buildFullRootViewAdditionalViewClasses:function(){var e=[];return e=e.concat(this._buildSubviewRootViewAdditionalViewClasses()),this.set("rootViewAdditionalViewClasses",e),this},_buildSubviewRootViewAdditionalViewClasses:function(){this.setRootViewAdditionalViewClasses();var e=this.get("rootViewAdditionalViewClasses")||[],i=this;return Object.keys(this.subviews).forEach(function(t){var r=i.subviews[t]._buildSubviewRootViewAdditionalViewClasses();e=e.concat(r)}),e},_setupDeferredSubviewsInitialization:function(){setTimeout(function(){var i=e.config.win.document.body;i.scrollTop>0||i.clientHeight-50<=i.scrollHeight?this._loadDeferredSubviews():(this.deferredViewScrollListener=e.globalEvents.subscribe("window:scroll",this._loadDeferredSubviews.bind(this)),this.registerEventHandler(this.deferredViewScrollListener))}.bind(this),10)},_loadDeferredSubviews:function(){this.loadingDeferred||(this.loadingDeferred=!0,this._removeDeferredViewScrollListener(),this._recursivelyLoadDeferredSubview(0,!1))},_removeDeferredViewScrollListener:function(){this.deferredViewScrollListener&&(this.deferredViewScrollListener.detach(),this.deferredViewScrollListener=null)},_recursivelyLoadDeferredSubview:function(i,r){var n=Object.keys(this.subviewConfig||[]).filter(function(e){var i=this.subviewConfig[e];return!0!==i.disabled&&(("function"!=typeof i.disabled||!i.disabled.call(this,this._params))&&this.subviewConfig[e].canDefer)}.bind(this)),a=this;if(i<=n.length-1){var s,o=n[i],u=e.merge(this._params,this.subviewConfig[o]);u.container=null,u.wasDeferred=!0,t.log("Loading deferred view",{topic:a.name,view:o});try{s=this.appContext.getView(o,u)}catch(e){return void this._onDeferredViewLoadingError(i,r,e)}s.then(function(e){if(!e)return t.error("An error occured trying to load the deferred view.",{topic:a.name}),r?(i++,r=!1):r=!0,void a._recursivelyLoadDeferredSubview(i,r);e.initialize(u).then(function(){e.on("subviewViewEvent",function(i){i&&i.details&&i.details.length&&a.onSubviewEvent.call(a,e.name,i.details)}),u&&u.additionalViewClasses&&u.additionalViewClasses.forEach(function(i){e.get("container").addClass(i)}),a._addDeferredViewToDOM(e),e.normalizedActivate(),i++,a._recursivelyLoadDeferredSubview(i,!1)}).catch(a._onDeferredViewLoadingError.bind(this,i,r))})}},_onDeferredViewLoadingError:function(e,i,r){t.error("An error occured trying to initialize the deferred view",{topic:this.name,err:r}),i?(e++,i=!1):i=!0,this._recursivelyLoadDeferredSubview(e,i)},_addDeferredViewToDOM:function(e){if(e){var i=this.get("container").one("."+e.name),r=e.get("container");i&&r?i.replace(r):t.error("Could not add view to DOM in _addDeferredViewToDOM",{topic:this.name,view:e.name})}else t.error("Non-view passed to _addDeferredViewToDOM.",{topic:this.name})},attachKeyEvent:function(e,i,t){return this.registerEventHandler(this.appContext.getKeyboardManager().on(e,t||this._params.keyEventScope||"*",i.bind(this)))},setContainerHTML:function(e){var i=this;return this.get("container").setHTML(e),YUI.Env.isServer||(this.get("container").generateID(),Object.keys(this.subviews||{}).forEach(function(e,t,r){var n=i.subviews[e],a=n.get("container"),s=n.getId?n.getId():a._yuid,o=i.get("container").one("#"+s);o&&o.replace(a)})),this},setupSubviews:function(){var i,r=this,n=[],a=[],s=[],o=this.appContext.flipper.isFlipped("enable-non-blocking-on-non-required-views"),u={};if(!this.subviewConfig)return e.Promise.resolve();if(Object.keys(this.subviewConfig).forEach(function(e){!0!==r.subviewConfig[e].disabled&&("function"==typeof r.subviewConfig[e].disabled&&r.subviewConfig[e].disabled.call(r,r._params)||(u[e]=r.subviewConfig[e]))}),Object.keys(u).map(function(l){i=YUI.Env.isServer?u[l].requiredToShowOnServer||u[l].requiredToShow||r.appContext.forceServerRender&&!u[l].neverShowOnServer:u[l].requiredToShowOnClient||u[l].requiredToShow;var c=e.merge(r._params,u[l]);if(!r.shouldDeferSubviews&&c.canDefer&&delete c.canDefer,r.shouldDeferSubviews&&c.canDefer){t.log("Deferring subview.",{topic:r.name,view:l});(o?s:n).push(r.instantiateSubview(l,c).then(function(e){return e.setContainerHTML(""),e.get("container").addClass("deferred-view"),e}))}else if(i){(o?a:n).push(r.instantiateSubview(l,c).then(function(e){return e.wasRequiredToShow=!0,r.setupSubview(l,c,e)}))}else{(o?s:n).push(r.instantiateSubview(l,c).then(function(i){i.wasRequiredToShow=!1,YUI.Env.isServer||e.soon(function(){r.setupSubview(l,c,i)})}))}}).filter(function(e){return!!e}),o){return(a.length?e.Promise.all(a):e.Promise.resolve()).then(function(){s.length&&!YUI.Env.isServer&&e.Promise.all(s).then(function(){r.buildContainer(),r.normalizedActivate()})})}return n.length?e.Promise.all(n):e.Promise.resolve()},registerSubview:function(e,i){i||(i=e.name),this.subviews[i]=e},instantiateSubview:function(i,r){var n=this;return r.container=this.getContainer({isSubview:!0,subviewName:i,subviewParams:r}),this.appContext.getView(i,r).then(null,function(){return t.log("getView failed to load view, retrying once more."),n.appContext.getView(i,r)}).then(function(e){return e.on("loadingError",n.handleSubviewLoadingError.bind(n)),e.on("loadingSuccess",n.handleSubviewLoadingSuccess.bind(n)),e.on("subviewViewEvent",n.handleSubviewEvent.bind(n,e.name)),n.registerSubview(e,i),e._params&&(e._params.keyEventScope=n._params.keyEventScope),e}).catch(e.PromiseCatcher(this.name))},onSubviewEvent:function(e,i){return!0},onParentViewEvent:function(e,i){return!0},handleSubviewEvent:function(e,i){var t=i?i.details||[]:[];!1!==this.onSubviewEvent(e,t)&&this.fire.apply(this,["subviewViewEvent"].concat(t))},handleParentViewEvent:function(e,i){var t,r=i?i.details||[]:[];if(!1!==this.onParentViewEvent(e,r))for(t in this.subviews)this.subviews[t].fire.apply(this.subviews[t],["parentViewEvent"].concat(r))},handleSubviewLoadingSuccess:function(e){this.subviewsWithLoadingError[e.target.name]&&delete this.subviewsWithLoadingError[e.target.name]},handleSubviewLoadingError:function(e){var i;this.subviewConfig[e.target.name].dealbreaker&&(this.hasDealbreakerSubviewLoadingError=!0),this.subviewsWithLoadingError[e.target.name]=e.details[0],this.isErrorBuilt||(i=Object.keys(this.subviewsWithLoadingError),(this.hasDealbreakerSubviewLoadingError||i.length>=2)&&(this.error={message:"",fatal:!0},i.forEach(function(e,t){var r=this.subviewsWithLoadingError[e];t!==i.length-1?this.error.message+="["+e+"] "+r.message+" | ":this.error.message+="["+e+"] "+r.message,r.is404&&(this.error.is404=!0),r.method&&(this.error.method+=r.method),r.fatal||(this.error.fatal=!1)}.bind(this)),this.fire("loadingError",{message:this.error.message,fatal:this.error.fatal,is404:this.error.is404,wasDealbreaker:this.hasDealbreakerSubviewLoadingError,wasMultipleSubviews:i&&i.length>=2}),this.buildErrorContainer(),this.isErrorBuilt=!0,t.error("subview forced the error loading state",{topic:this.name,view:e.target.name})))},setupSubview:function(i,r,n){var a=this;return r=e.merge(r||{}),r.alreadyRendered=a.alreadyRendered,n.set("isActiveViewAgnostic",a.get("isActiveViewAgnostic")),n.initialize(r).then(function(){return a.subviews[i]},function(e){t.error("Error getting/initializing view",{topic:a.name,err:e,view:i})}).catch(e.PromiseCatcher(this.name))},attachEvents:function(i){if(i){var t={},r=this;Object.keys(i).forEach(function(n){var a,s;a={selector:(n.match(/([\w-_#\.\[\]~|$^*= ]+) /i)||[])[1]||"[data-action]",type:(n.match(/([\w]+):/i)||[])[1]||"click",action:(n.match(/:([\w]+)/i)||[])[1]||"_default_"},t[s=a.selector+"/"+a.type]||(t[s]={},r.registerEventHandler(r.get("container").delegate(a.type,function(i){var n,o,u,l;if(n=i.target.ancestor(a.selector,!0),"click"===a.type&&(o=i.target.ancestor(".server-only-link",!0)))return!0===i.metaKey||!0===i.ctrlKey?void 0:void(e.config.win.location=o.get("href"));if(n&&(u=n.getData()||{},l=u.action||"_default_",t[s].hasOwnProperty(l))){if(!t[s][l])throw new Error('Handler for "'+l+'" UI event is undefined');t[s][l].call(r,i,u)}},a.selector))),t[s][a.action]=i[n]})}},registerEventHandler:function(i){if(e.Lang.isFunction(i.detach))return this._eventHandles.push(i),i},detachRegisteredEvent:function(i){var t=this._eventHandles.indexOf(i);-1!==t&&e.Lang.isFunction(i.detach)&&(i.detach(),this._eventHandles.splice(t,1))},detachRegisteredEvents:function(){this._eventHandles.length&&(this._eventHandles.forEach(function(e){e.detach()}),this._eventHandles=[])},generateSignature:function(i,t){var r,n={},a=function(e){var i=0;if(0===e.length)return i;for(var t=0;t<e.length;t++)i=(i<<5)-i+(r=e.charCodeAt(t)),i&=i;return i};return e.Object.each(t,function(e,i){"container"!==i&&"appContext"!==i&&"context"!==i&&"cspNonce"!==i&&"parentView"!==i&&"keyEventScope"!==i&&void 0!==e&&"function"!=typeof e&&(n[i]="object"==typeof e?1:e)}),i+"__"+Object.keys(n).sort().map(function(e){var i,t;try{i=encodeURIComponent(e)}catch(t){i=encodeURIComponent(a(e))}try{t=encodeURIComponent(n[e])}catch(t){i=encodeURIComponent(a(n[e]))}return i+"_"+t}).join("__")},getContainer:function(i){(i=i||{}).subviewParams=i.subviewParams||{};var t,r,n,a,s=["view",i.subviewName||i.viewName||this.name],o=i.subviewName?i.subviewParams.additionalViewClasses:this.additionalViewClasses,u=i.subviewParams.preferredViewTag||"div";return(!i.isSubview||i.subviewParams.requiredToShowOnServer||i.subviewParams.requiredToShow)&&YUI.Env.isServer&&s.push("requiredToShowOnServer"),this.theme&&s.push(this.theme),e.Lang.isArray(o)&&o.length?s=s.concat(o):e.Lang.isFunction(o)&&(a=o.call(this),e.Lang.isArray(a)&&a.length&&(s=s.concat(a))),i.subviewName||s.push(e.FlickrView.ROOT_VIEW_CLASS_NAME),s=' class="'+s.join(" ")+'"',i.subview?t=i.subview.getId():i.subviewName&&i.subviewParams&&(t=this.generateSignature(i.subviewName,i.subviewParams)),YUI.Env.isServer?r={html:"",setHTML:function(e){this.html=e},getHTML:function(e){return this.html},get:function(e){switch(e){case"innerHTML":return this.html;case"outerHTML":return"<"+u+" "+s+(n?' style="'+Object.keys(n).reduce(function(e,i,t,r){return e+i+": "+n[i]+(t<r.length-1?"; ":"")},"")+'"':"")+(t?' data-view-signature="'+t+'"':"")+">"+this.html+"</"+u+">"}return null},hasChildNodes:function(){return!1},addClass:function(e){""!==(e=e.trim())&&(s=s.slice(0,-1)+" "+e+'"')},hasClass:function(e){return s.split('"')[1].split(" ").indexOf(e)>-1},removeClass:function(e){var i=s.split('"')[1].split(" "),t=i.indexOf(e);-1!==t&&(i.splice(t,1),s=' class="'+i.join(" ")+'"')},setStyle:function(e,i){n||(n={}),n[e]=i},setStyles:function(e){n||(n={}),Object.keys(e).forEach(function(i){n[i]=e[i]})},appendChild:function(e){this.html+=e.html},all:function(){return{each:function(){}}},one:function(){return null}}:(t&&(r=this.get("container").one('[data-view-signature="'+t+'"]')),r?r.removeAttribute("data-view-signature"):r=e.Node.create("<"+u+" "+s+"></"+u+">")),r},renderSubviews:function(){var e=this;return Object.keys(this.subviews).forEach(function(i,r,n){try{e.subviews[i].render()}catch(r){t.error("Error rendering view",{topic:e.name,err:r,view:i})}}),{}},templates:function(i){var r,n=e.Template.get("hermes/"+i),a=this.getLangBundles(),s=this;if(a.locales=this.appContext.lang||this.defaultLang,"function"!=typeof n)throw t.error("Template not found",{topic:this.name,template:i}),new Error("Template not found: "+i);return this.appContext.flipper&&(r=this.appContext.flipper),function(e){return!(e=e||{}).flippers&&r&&(e.flippers=r.toJSON()),e.isMobile=s._params.isMobile,e.cspNonce=s._params.cspNonce,s.appContext.forceServerRender&&(e.isServerRendered=!0),Object.keys(s.subviewConfig||{}).forEach(function(i){e[i]||(e[i]=s.subviews[i]?s.subviews[i].get("container"):"")}),n(e,{data:{intl:a,flippers:e.flippers}})}},loadState:function(){return e.Promise.resolve()},updateHead:function(){null!==this.get("headContainer")&&(e.one("head").all('[data-dynamic="true"]').remove(!0),e.one("head").append(this.get("headContainer")))},canActivate:function(){var e=!1;return(this.isBuilt||this.isErrorBuilt)&&(this.isActivated||this.isErrorActivated||this.isActiveAndInDOM()&&(e=!0)),e},isActiveAndInDOM:function(){var e=this.get("container");return e&&(this.get("isActiveViewAgnostic")||this.appContext.flapp.get("activeView").get("container").contains(e))&&e.inDoc()},activate:function(){return this},activateSubviews:function(){var e,i;for(e in this.subviews){i=this.subviews[e];try{i.normalizedActivate(),i.recursivelyActivateSubviews()}catch(i){t.error("Error activating view",{topic:this.name,err:i,view:e})}}return this},recursivelyActivateSubviews:function(e){var i,r,n=e||this.subviews;for(i in n)if((r=n[i]).canActivate()){r.normalizedActivate();try{r.normalizedActivate(),this.recursivelyActivateSubviews(r.subviews)}catch(e){t.error("Error activating view",{topic:this.name,err:e,view:r})}}return this},normalizedActivate:function(){this.canActivate()&&(this.isErrorBuilt?(this.isErrorActivated=!0,this.activateErrorContainer()):(this.activate(),this.isActivated=!0,this.activateSubviews()))},onCSSLoaded:function(i){var t=this;this.appContext.isCSSLoaded?i.call(t):this.registerEventHandler(e.on("css-loaded",function(){i.call(t)}))},buildErrorContainer:function(){this.setContainerHTML("")},activateErrorContainer:function(){var e=this,i=this.get("container").one(".retry");i&&i.on("click",function(i){i.preventDefault(),e.isErrorActivated=!1,e.initialize()})},setViewDataOnHistory:function(i,t){return e.HistoryHelper.setData(this.name,i,t)},getViewDataFromHistory:function(i){return e.HistoryHelper.getData(this.name,i)},getTrackingSegments:function(){return{}},updateDataLayer:function(){},reload:function(i,t){var r=this,n=[];if(!i.length)return e.Promise.resolve();for(var a=0;a<i.length;a++)n.push(this.appContext.getModelRegistry(i[a]));return e.Promise.all(n).then(function(e){for(var i=0;i<e.length;i++)Array.isArray(t)?e[i].remove(t[i]):e[i].remove(t);YUI.Env.isServer||r.appContext.flapp.navigate(r.appContext.getLocation().href)}).catch(e.PromiseCatcher(this.name))},destroy:function(i){this.set("destroyed",!0);var t,r=this.get("container");if(this.detachRegisteredEvents(),!YUI.Env.isServer&&this.isActiveAndInDOM()){this.setRootViewAdditionalViewClasses();var n=this.get("rootViewAdditionalViewClasses")||[],a=e.one("."+e.FlickrView.ROOT_VIEW_CLASS_NAME);n&&a&&n.forEach(function(e){a.removeClass(e)})}return this._removeDeferredViewScrollListener(),e.Node&&r&&(r.detach&&r.detach(),i&&(i.remove||i.delete)&&r.remove&&r.remove(!0),this.set("container",null)),this.destroySubviews(),t=e.FlickrView.superclass.destroy.call(this),this.beforeDestroyHandler&&this.beforeDestroyHandler.detach(),t},destroySubviews:function(){var e=this;Object.keys(this.subviews||{}).forEach(function(i,t,r){e.subviews[i].destroy()})},bringIntoFocus:function(){var e=this.get("container"),i=e.getAttribute("tabindex")||null;e.setAttribute("tabindex","-1"),e.focus(),e.blur(),i?e.setAttribute("tabindex",i):e.removeAttribute("tabindex")},setContainerWithTemplate:function(e,i){this.setContainerHTML(this.templates(e)(i))},godMessage:e.godMessage},{ATTRS:{container:{value:"",setter:function(e){return e||this.getContainer()}},spaceid:{value:792600503,validator:function(i){return e.Lang.isNumber(i)||e.Lang.isString(i)},setter:function(e){return parseInt(e,10)}},trackedElementIDs:{value:[],validator:function(i){return e.Lang.isArray(i)}},rapidConf:{value:{},validator:function(i){return e.Lang.isObject(i)}},isActiveViewAgnostic:{value:!1},isRootView:{value:!1},rootViewAdditionalViewClasses:{value:[],validator:function(i){return e.Lang.isArray(i)}},isCSSLoaded:{getter:function(){return!!this.appContext.isCSSLoaded}}},create:function(i,r,n,a,s){e.namespace("Views"),e.Views[i]&&t.warn("A view with this name already exists. Did you mean to redefine it?",{view:i}),a.destroy&&a.destroy!==e.FlickrView.prototype.destroy&&t.warn("`destroy` method was overridden. Did you mean `destructor`?",{view:i}),a.initialize&&a.initialize!==e.FlickrView.prototype.initialize&&t.warn("`initialize` method was overridden. Did you mean `initializer`?",{view:i});try{e.Views[i]=e.Base.create(i,r,n,a,s)}catch(r){throw t.warn("`Base.create` method failed, maybe because of Chrome 51?",{view:i}),!YUI.Env.isServer&&e.config.win.beaconError&&e.config.win.beaconError("`Base.create` method failed, maybe because of Chrome 51?",e.config.win.location.href,r),r}if(r&&r!==e.FlickrView&&r.prototype&&r.prototype.langBundles){var o=[],u=(e.Views[i].prototype.langBundles||[]).concat(r.prototype.langBundles);o=e.Array.dedupe(u),e.Views[i].prototype.langBundles=o}return e.Views[i]},ROOT_VIEW_CLASS_NAME:"flickr-view-root-view"}),e.mix(e.FlickrView.prototype,e.Localizable)},"@VERSION@",{requires:["base","template-base","flickr-promise","handlebars-base","handlebars-helpers","localizable","history-helper","god-message"]});YUI.add("banner-view",function(i,e){require("hermes-core/flog")(e);i.FlickrView.create(this.name,i.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(i){this.params=i,this.subview=this.params.subview},loadState:function(){return i.Promise.resolve()},buildContainer:function(){},activate:function(){var i=this,e=this.get("container");return this.subviewParent=e,this.subview?(this.subview.on("dismiss",function(e){i.dismiss()}),this.subview.initialize().then(function(){return i.setupSubview()})):this},setupSubview:function(){var i=this,e=i.subview.get("container");return i.subviewParent.empty(),i.subviewParent.appendChild(e),i.subview.on("activated",function(){i.fire("subviewActivated")}),i.subview.activate()},dismiss:function(){this.get("container").remove(),this.fire("dismissed"),this.destroy()}})},"@VERSION@",{requires:["flickr-view"],langBundles:["common"]});