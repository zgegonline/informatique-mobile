YUI.add("notification-event-testimonial-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,attributes:{type:{},owner:{isModel:!0},timestamp:{},url:{}}})},"@VERSION@",{requires:["flickr-model-registry"]});YUI.add("flickr-activity-recentByType-OLD-fetcher",function(e,t){"use strict";e.namespace("ListFetchers")["flickr-activity-recentByType-OLD"]={run:function(o,i){var r=this,s=this._processParams(o);return new e.FlickrPromise({apiResponse:i.callAPI("flickr.activity.recentByType",s),notificationModelRegistry:i.getModelRegistry("notification-OLD-models"),notificationsModelRegistry:i.getModelRegistry("person-notifications-models"),groupInfoModelRegistry:i.getModelRegistry("group-info-models"),groupModelRegistry:i.getModelRegistry("group-models"),personModelRegistry:i.getModelRegistry("person-models"),photoModelRegistry:i.getModelRegistry("photo-models"),contactModelRegistry:i.getModelRegistry("contact-models"),photoEngagementModelRegistry:i.getModelRegistry("photo-engagement-models"),personRelationshipModelRegistry:i.getModelRegistry("person-relationship-models"),photoStatsRegistry:i.getModelRegistry("photo-stats-models"),discussionModelRegistry:i.getModelRegistry("notification-group-discussion-models"),galleryModelRegistry:i.getModelRegistry("notification-gallery-models"),flickrMailModelRegistry:i.getModelRegistry("notification-flickrmail-models"),faveEventModelRegistry:i.getModelRegistry("notification-event-fave-models"),commentEventModelRegistry:i.getModelRegistry("notification-event-comment-models"),followerEventModelRegistry:i.getModelRegistry("notification-event-follower-models"),addedToGalleryEventModelRegistry:i.getModelRegistry("notification-event-added-to-gallery-models"),tagEventModelRegistry:i.getModelRegistry("notification-event-tag-models"),peopleEventModelRegistry:i.getModelRegistry("notification-event-people-models"),photoCommentMentionNotifRegisty:i.getModelRegistry("notification-event-photo-comment-mention-models"),photoGroupInviteNotifRegistry:i.getModelRegistry("notification-event-photo-group-invite-models"),groupNotifModelRegistry:i.getModelRegistry("notification-event-group-models"),noteEventModelRegistry:i.getModelRegistry("notification-event-note-models"),shareEventModelRegistry:i.getModelRegistry("notification-event-share-models"),uploadEventModelRegistry:i.getModelRegistry("notification-event-upload-models"),groupReplyEventModelRegistry:i.getModelRegistry("notification-event-group-reply-models"),friendJoinEventModelRegistry:i.getModelRegistry("notification-event-friend-join-models"),groupTopicNewEventModelRegistry:i.getModelRegistry("notification-event-group-topic-new-models"),flickrMailEventModelRegistry:i.getModelRegistry("notification-event-flickrmail-models"),testimonialEventModelRegistry:i.getModelRegistry("notification-event-testimonial-models")}).then(function(e){return r._processResponse(e,o,s,i)},e.FetcherErrorLogger(t))},_processParams:function(t){var o,i={extras:["sizes","icon_urls","ignored","rev_ignored","tags","autotags","datecreate"].join(",")+","+e.APIHelper.request.getRebootPhotoExtras(),per_page:t.perPage||30,count:30,page:t.page||1,per_object:50};return o=e.merge(i,t.apiParams||{}),YUI.Env.isServer&&e.SearchHelper.unescapeParameters(o),o},_processResponse:function(t,o,i,r){var s,n,l,a=t.apiResponse,d=t.notificationModelRegistry,p=t.notificationsModelRegistry,g=t.photoModelRegistry,c=t.personModelRegistry,y=t.contactModelRegistry,m=t.groupModelRegistry,f=(t.personRelationshipModelRegistry,t.photoEngagementModelRegistry),u=t.photoStatsRegistry,R=t.discussionModelRegistry,M=t.galleryModelRegistry,v=t.flickrMailModelRegistry,h=[];return s={fave:t.faveEventModelRegistry,comment:t.commentEventModelRegistry,contacted:t.followerEventModelRegistry,gallery:t.addedToGalleryEventModelRegistry,tag:t.tagEventModelRegistry,people:t.peopleEventModelRegistry,photo_comment_mention:t.photoCommentMentionNotifRegisty,group_invite:t.photoGroupInviteNotifRegistry,group_user_invite:t.groupNotifModelRegistry,note:t.noteEventModelRegistry,share:t.shareEventModelRegistry,upload:t.uploadEventModelRegistry,reply_reply:t.groupReplyEventModelRegistry,topic_reply:t.groupReplyEventModelRegistry,friend_join:t.friendJoinEventModelRegistry,group_topic_new:t.groupTopicNewEventModelRegistry,flickrmail:t.flickrMailEventModelRegistry,testimonial:t.testimonialEventModelRegistry},a.items.item.forEach(function(t){var o,i,n,a,p=t.activity?t.activity.event:[];if(o={objectType:t.type,seen:1===t.seen,id:e.guid(),events:[],isMuted:1===t.is_muted},"photo"===t.type){var E=e.clone(t);if(E.title){var _=E.title.content||E.title._content;E.title=_}o.object=e.APIHelper.response.parsePhotos({photos:[E],photoModelRegistry:g,personModelRegistry:c,photoEngagementModelRegistry:f,photoStatsModelRegistry:u}).shift()}else"person"===t.type?c.exists(t.id)?o.object=c.proxy(t.id):o.object=c.add(e.APIHelper.response.parsePerson({nsid:t.user,pathAlias:t.pathAlias,username:t.username,realname:t.realname,isAdFree:t.isAdFree,ispro:t.ispro,proBadge:t.proBadge,datecreate:t.datecreate,iconurls:t.iconurls})):"group"===t.type?m.exists(t.id)?o.object=m.proxy(t.id):o.object=m.add(m.parseGroupModel(t.id,t.pathAlias,t)):"discussion"===t.type?((n=e.clone(t)).id=t.group_id,n.title=t.group_name,a=m.exists(t.group_id)?m.proxy(t.group_id):m.add(m.parseGroupModel(t.group_id,t.pathAlias,n)),R.exists(t.id)?o.object=R.proxy(t.id):o.object=R.add(R.parseDiscussionModel(t.id,t.pathAlias,t,a))):"gallery"===t.type?o.object=M.addOrUpdate(M.parseGalleryModel(t)):"flickrmail"===t.type&&(o.object=v.addOrUpdate(v.parseFlickrMailModel(t)));p.forEach(function(n){var a,d,p;if(n.type in s){if("people"===n.type)l={},d=e.APIHelper.response.parseContact({nsid:n.person,username:n.personname}),p=e.APIHelper.response.parseContact({nsid:n.user,username:n.realname}),l.personTagged=y.exists(d.id)?y.proxy(d.id):y.add(d),l.tagger=y.exists(p.id)?y.proxy(p.id):y.add(p);else if("group_invite"===n.type)n.name=n.groupName,n.id=n.groupId,n.iconurls=n.group_iconurls,l=m.exists(n.id)?m.proxy(n.id):m.add(m.parseGroupModel(n.groupId,n.pathAlias,n));else{if("note"===n.type&&!r.flipper.isFlipped("enable-scrappy-notes"))return;if("gallery"===n.type)l={id:n.galleryid,title:n.title,url:"/photos/"+n.owner+"/galleries/"+n.galleryid,iconurls:n.gallery_iconurls};else if("flickrmail"===n.type)l={mail:{id:t.id,title:t.title,url:"/mail/"+t.id},owner:{nsid:t.user,username:t.username,realname:t.realname,iconserver:t.iconserver,iconfarm:t.iconfarm,pathAlias:t.pathalias,iconUrls:t.iconurls}};else if("testimonial"===n.type){var g=c.proxy(r.getViewer().nsid),f=e.URLHelper.generatePersonUrls(g),u=(f.profile,f.profile.slice(0,f.profile.length-1)+"#testimonial"+t.id);l={id:t.id,owner:{nsid:t.user,username:t.username,realname:t.realname,iconserver:t.iconserver,iconfarm:t.iconfarm,pathAlias:t.pathalias,iconUrls:t.iconurls},url:u}}else if("contacted"===n.type)n.iconurls=t.iconurls;else if("upload"===n.type){var R=e.APIHelper.response.parsePhoto(n,t.id);l={title:n.title.content,url:t.url,photo:R,owner:R.owner}}}if(a=e.APIHelper.response.parseNotificationsEvents[n.type](n,l),a.owner=y.addOrUpdate(a.owner),a.owner.getValue("isMe")&&"group_user_invite"!==n.type)return;i=s[n.type].addOrUpdate(a),o.events.push(i)}}),d.exists(o.id)||h.push(d.add(o))}),n={notifications:h},p.exists(o.id)?p.getValue(o.id,"notifications").addPage({page:i.page,perPage:i.per_page,pageContent:h,totalItems:parseInt(a.items.total||0,10)}):p.add(n),h}}},"@VERSION@",{requires:["flickr-promise","search-helper","querystring-parse-simple"],optional:["url-helper","notification-OLD-models","person-notifications-models","contact-models","photo-models","notification-group-discussion-models","notification-gallery-models","notification-flickrmail-models","notification-event-fave-models","notification-event-comment-models","notification-event-follower-models","notification-event-added-to-gallery-models","notification-event-people-models","notification-event-tag-models","notification-event-photo-comment-mention-models","notification-event-photo-group-invite-models","notification-event-group-models","notification-event-note-models","notification-event-share-models","notification-event-upload-models","notification-event-group-reply-models","notification-event-flickrmail-models","notification-event-testimonial-models"]});YUI.add("flickr-notifications-markread-updater",function(r,i){"use strict";r.namespace("ModelUpdaters")["flickr-notifications-markread"]={run:function(e,a){return a.callAPI("flickr.notifications.markread",e).then(null,r.FetcherErrorLogger(i))}}},"@VERSION@",{requires:["flickr-promise"]});YUI.add("flickr-activity-getNotificationsCount-fetcher",function(t,i){"use strict";t.namespace("ModelFetchers")["flickr-activity-getNotificationsCount"]={run:function(e,o){var n=this;return t.FlickrPromise({apiResponse:o.callAPI("flickr.activity.getNotificationsCount",e),personNotifsModelRegistry:o.getModelRegistry("person-notifications-models")}).then(function(t){return n._processResponse(t,o,e)},t.FetcherErrorLogger(i))},_processResponse:function(t,i,e){var o=t.apiResponse;return t.personNotifsModelRegistry.setValue(e.id,"unseenNotificationCount",o.activity.count),o.activity.count}}},"@VERSION@",{requires:["flickr-promise"],optional:["person-notifications-models","api-helper"]});YUI.add("flickr-activity-muteObject-updater",function(e,t){"use strict";e.namespace("ModelUpdaters")["flickr-activity-muteObject"]={run:function(r,c){var i=r;return c.callAPI("flickr.activity.muteObjectByType",i).then(null,e.FetcherErrorLogger(t))}}},"@VERSION@",{requires:["flickr-promise"]});YUI.add("flickr-activity-unmuteObject-updater",function(e,t){"use strict";e.namespace("ModelUpdaters")["flickr-activity-unmuteObject"]={run:function(r,c){var i=r;return c.callAPI("flickr.activity.unmuteObjectByType",i).then(null,e.FetcherErrorLogger(t))}}},"@VERSION@",{requires:["flickr-promise"]});